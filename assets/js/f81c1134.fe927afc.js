"use strict";(self.webpackChunkjohnycho_dev=self.webpackChunkjohnycho_dev||[]).push([[8130],{7735:n=>{n.exports=JSON.parse('{"archive":{"blogPosts":[{"id":"fault-tolerance-high-availability","metadata":{"permalink":"/blog/fault-tolerance-high-availability","source":"@site/blog/2025-08-15-fault-tolerance-high-availability.mdx","title":"\ub0b4\uacb0\ud568\uc131(Fault Tolerance)\uacfc \uace0\uac00\uc6a9\uc131(High Availability) \uc81c\ub300\ub85c \uc774\ud574\ud558\uae30","description":"\ubd84\uc0b0 \uc2dc\uc2a4\ud15c\uacfc \ud074\ub77c\uc6b0\ub4dc \ud658\uacbd\uc5d0\uc11c \ub0b4\uacb0\ud568\uc131(Fault Tolerance)\uacfc \uace0\uac00\uc6a9\uc131(High Availability)\uc740 \ub9e4\uc6b0 \uc911\uc694\ud55c \uac1c\ub150\uc785\ub2c8\ub2e4.","date":"2025-08-15T00:00:00.000Z","tags":[{"inline":false,"label":"SystemDesign","permalink":"/blog/tags/system-design","description":"SystemDesign tag description"},{"inline":false,"label":"Architecture","permalink":"/blog/tags/architecture","description":"Architecture tag description"}],"readingTime":8.33,"hasTruncateMarker":true,"authors":[{"name":"Johny Cho","title":"Back End Engineer @ NHN","url":"https://github.com/johnycho","page":{"permalink":"/blog/authors/johnycho"},"socials":{"github":"https://github.com/johnycho","instagram":"https://www.instagram.com/johny__cho","linkedin":"https://www.linkedin.com/in/johny-cho/"},"imageURL":"https://github.com/johnycho.png","key":"johnycho"}],"frontMatter":{"slug":"fault-tolerance-high-availability","title":"\ub0b4\uacb0\ud568\uc131(Fault Tolerance)\uacfc \uace0\uac00\uc6a9\uc131(High Availability) \uc81c\ub300\ub85c \uc774\ud574\ud558\uae30","authors":["johnycho"],"tags":["system-design","architecture"]},"unlisted":false,"nextItem":{"title":"Outbox \ud328\ud134\uc73c\ub85c Kafka Exactly-Once\uc5d0 \uac00\uae4c\uc6cc\uc9c0\uae30","permalink":"/blog/kafka-exactly-once"}},"content":"\x3c!-- truncate --\x3e\\n<br /><br />\\n\\n\ubd84\uc0b0 \uc2dc\uc2a4\ud15c\uacfc \ud074\ub77c\uc6b0\ub4dc \ud658\uacbd\uc5d0\uc11c **\ub0b4\uacb0\ud568\uc131(Fault Tolerance)**\uacfc **\uace0\uac00\uc6a9\uc131(High Availability)**\uc740 \ub9e4\uc6b0 \uc911\uc694\ud55c \uac1c\ub150\uc785\ub2c8\ub2e4.  \\n\ub450 \uc6a9\uc5b4\ub294 \uc885\uc885 \ud63c\uc6a9\ub418\uc9c0\ub9cc, \uc5c4\ubc00\ud788 \ub9d0\ud558\uba74 \uc11c\ub85c \ub2e4\ub978 \ucd08\uc810\uacfc \ud574\uacb0 \ubc29\uc2dd\uc744 \uac00\uc9c0\uace0 \uc788\uc2b5\ub2c8\ub2e4.  \\n\uc774\ubc88 \ud3ec\uc2a4\ud2b8\uc5d0\uc11c\ub294 \ub0b4\uacb0\ud568\uc131\uacfc \uace0\uac00\uc6a9\uc131\uc744 \uba85\ud655\ud788 \uad6c\ubd84\ud558\uace0, \uc2e4\uc81c \uc11c\ube44\uc2a4 \uc0ac\ub840\ub97c \ud1b5\ud574 \uac01\uac01\uc774 \uc5b4\ub5a4 \ubb38\uc81c\ub97c \ud574\uacb0\ud558\ub294\uc9c0 \uc0b4\ud3b4\ubcf4\uaca0\uc2b5\ub2c8\ub2e4.\\n\\n---\\n\\n## \ub0b4\uacb0\ud568\uc131(Fault Tolerance)\uc774\ub780?\\n\\n**\ub0b4\uacb0\ud568\uc131\uc774\ub780 \uc2dc\uc2a4\ud15c \uc77c\ubd80\uc5d0 \uc7a5\uc560\uac00 \ubc1c\uc0dd\ud558\ub354\ub77c\ub3c4 \uc11c\ube44\uc2a4 \uc694\uccad \ucc98\ub9ac\ub97c \uacc4\uc18d\ud560 \uc218 \uc788\ub3c4\ub85d \ud558\ub294 \ub2a5\ub825**\uc744 \uc758\ubbf8\ud569\ub2c8\ub2e4. \uc989, \uc7a5\uc560 \uc0c1\ud669\uc5d0\uc11c\ub3c4 \uc0ac\uc6a9\uc790\uac00 \uc815\uc0c1\uc801\uc778 \uc751\ub2f5\uc744 \ubc1b\uc744 \uc218 \uc788\ub3c4\ub85d \uc124\uacc4\ub41c \ud2b9\uc131\uc785\ub2c8\ub2e4.\\n\\n---\\n\\n## \ub0b4\uacb0\ud568\uc131 \uc0ac\ub840 \u2013 \uc7a5\uc560 \ubc1c\uc0dd \uc2dc\uc5d0\ub3c4 \uc11c\ube44\uc2a4\uac00 \uc9c0\uc18d\ub41c\ub2e4\\n\\n### \uc0ac\ub840 1: \uc8fc\ubb38 \uc870\ud68c \uc11c\ube44\uc2a4\uc5d0\uc11c \uce90\uc2dc \uc7a5\uc560\\n\\n**\uc0c1\ud669**\\n- \uc0ac\uc6a9\uc790\uac00 \uc8fc\ubb38 \ub0b4\uc5ed\uc744 \uc870\ud68c\ud560 \ub54c, \uc2dc\uc2a4\ud15c\uc740 Redis \uce90\uc2dc\ub97c \uc6b0\uc120 \uc870\ud68c\ud558\uace0, \uce90\uc2dc\uc5d0 \ub370\uc774\ud130\uac00 \uc5c6\uc73c\uba74 DB\ub97c \uc870\ud68c\ud569\ub2c8\ub2e4.\\n\\n**\uc7a5\uc560 \ubc1c\uc0dd**\\n- Redis \uc11c\ubc84\uac00 \uc7a5\uc560\ub97c \uc77c\uc73c\ud0b5\ub2c8\ub2e4.\\n\\n#### \ub0b4\uacb0\ud568\uc131\uc774 \uc5c6\ub294 \uacbd\uc6b0\\nRedis \uc7a5\uc560\ub85c \uc778\ud574 \uc608\uc678\uac00 \ubc1c\uc0dd\ud558\uace0, \uc8fc\ubb38 \uc870\ud68c\uac00 \uc2e4\ud328\ud569\ub2c8\ub2e4.\\n\\n#### \ub0b4\uacb0\ud568\uc131\uc774 \uc801\uc6a9\ub41c \uacbd\uc6b0\\nRedis \uc7a5\uc560\uac00 \ubc1c\uc0dd\ud574 \uce90\uc2dc \uc870\ud68c\uc5d0 \uc2e4\ud328\ud558\ub354\ub77c\ub3c4 DB\ub85c \ub300\uccb4 \uc870\ud68c\ub97c \uc218\ud589\ud558\uc5ec \uc8fc\ubb38 \uc870\ud68c\uac00 \uc815\uc0c1\uc801\uc73c\ub85c \ucc98\ub9ac\ub429\ub2c8\ub2e4.\\n\\n**\uc774\ucc98\ub7fc \uc7a5\uc560\uac00 \ubc1c\uc0dd\ud588\uc9c0\ub9cc \uc11c\ube44\uc2a4\ub294 \uc911\ub2e8\ub418\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4.**\\n\\n### \uc0ac\ub840 2: \uc678\ubd80 \uacb0\uc81c API \ud638\ucd9c \uc2e4\ud328\\n\\n**\uc0c1\ud669**\\n- \uacb0\uc81c \uc2b9\uc778 \uc2dc \uc678\ubd80 \uacb0\uc81c \ub300\ud589\uc0ac(PG) API\ub97c \ud638\ucd9c\ud569\ub2c8\ub2e4.\\n\\n**\uc7a5\uc560 \ubc1c\uc0dd**\\n- \uc77c\uc2dc\uc801\uc778 \ub124\ud2b8\uc6cc\ud06c \ud0c0\uc784\uc544\uc6c3\uc774 \ubc1c\uc0dd\ud569\ub2c8\ub2e4.\\n\\n#### \ub0b4\uacb0\ud568\uc131 \uc801\uc6a9\\n\uc7ac\uc2dc\ub3c4(Retry)\uc640 \ud68c\ub85c \ucc28\ub2e8\uae30(Circuit Breaker) \ud328\ud134\uc744 \ub3c4\uc785\ud558\uc5ec 1\ucc28 \ud638\ucd9c \uc2e4\ud328 \uc2dc \uc7ac\uc2dc\ub3c4\ub97c \uc218\ud589\ud558\uace0, \uc77c\uc815 \ud69f\uc218 \uc774\uc0c1 \uc2e4\ud328\ud558\uba74 \uc0ac\uc6a9\uc790\uc5d0\uac8c \uc2e4\ud328\ub97c \uc548\ub0b4\ud569\ub2c8\ub2e4.\\n\\n\uc774\ub97c \ud1b5\ud574 \uc7a5\uc560\uac00 \ub2e4\ub978 \uc11c\ube44\uc2a4\ub85c \ud655\uc0b0\ub418\uc9c0 \uc54a\uace0 \uc2dc\uc2a4\ud15c \uc804\uccb4\uc758 \uc548\uc815\uc131\uc774 \uc720\uc9c0\ub429\ub2c8\ub2e4.\\n\\n---\\n\\n## \uace0\uac00\uc6a9\uc131(High Availability)\uc774\ub780?\\n**\uace0\uac00\uc6a9\uc131\uc774\ub780 \uc2dc\uc2a4\ud15c\uc774 \uac00\ub2a5\ud55c \ud55c \uc624\ub79c \uc2dc\uac04 \ub3d9\uc548 \uc911\ub2e8 \uc5c6\uc774 \uc11c\ube44\uc2a4\ub97c \uc81c\uacf5\ud558\ub294 \ud2b9\uc131**\uc744 \uc758\ubbf8\ud569\ub2c8\ub2e4.  \\n\uc989, \uc11c\ube44\uc2a4\uac00 \uc5bc\ub9c8\ub098 \uc790\uc8fc \uadf8\ub9ac\uace0 \uc5bc\ub9c8\ub098 \uc624\ub798 \uc815\uc0c1\uc801\uc73c\ub85c \uc6b4\uc601\ub418\ub294\uc9c0\ub97c \ub098\ud0c0\ub0c5\ub2c8\ub2e4.\\n\\n---\\n\\n## \uace0\uac00\uc6a9\uc131 \uc0ac\ub840 \u2013 \uc7a5\uc560 \ubc1c\uc0dd \ud6c4 \ube60\ub978 \ubcf5\uad6c\\n\\n### \uc0ac\ub840 1: \uc6f9 \uc11c\ubc84 \uc7a5\uc560\\n\\n**\uc0c1\ud669**\\n- \uc6f9 \uc11c\ubc84 3\ub300\uac00 \ub85c\ub4dc\ubc38\ub7f0\uc11c \ub4a4\uc5d0\uc11c \uc11c\ube44\uc2a4\ub97c \uc81c\uacf5\ud569\ub2c8\ub2e4.\\n\\n```\\n                \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\\n                \u2502    User     \u2502\\n                \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\\n                       \u2502\\n                       \u25bc\\n              \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\\n              \u2502  Load Balancer  \u2502\\n              \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\\n                       \u2502\\n      \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\\n      \u2502                \u2502               \u2502\\n      \u25bc                \u25bc               \u25bc\\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\\n\u2502  Server A   \u2502 \u2502  Server B   \u2502 \u2502  Server C   \u2502\\n\u2502             \u2502 \u2502   (DOWN)    \u2502 \u2502             \u2502\\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\\n```\\n\\n**\uc7a5\uc560 \ubc1c\uc0dd**\\n- Server B\uac00 \ub2e4\uc6b4\ub429\ub2c8\ub2e4.\\n\\n#### \uace0\uac00\uc6a9\uc131 \uc801\uc6a9\\n\ud5ec\uc2a4\uccb4\ud06c\ub97c \ud1b5\ud574 Server B\uc758 \uc7a5\uc560\ub97c \uac10\uc9c0\ud558\uace0, \ub85c\ub4dc\ubc38\ub7f0\uc11c\uac00 \ud574\ub2f9 \uc11c\ubc84\ub97c \ud2b8\ub798\ud53d \ubd84\ubc30 \ub300\uc0c1\uc5d0\uc11c \uc81c\uc678\ud569\ub2c8\ub2e4. \uc774\ud6c4 \ud2b8\ub798\ud53d\uc740 Server A\uc640 Server C\ub85c \uc7ac\ubd84\ubc30\ub429\ub2c8\ub2e4.\\n\\n**\uc774\ub85c \uc778\ud574 \uc77c\ubd80 \uc11c\ubc84\uac00 \uc7a5\uc560\ub97c \uacaa\uc5c8\uc9c0\ub9cc, \uc0ac\uc6a9\uc790\ub294 \uac70\uc758 \uc7a5\uc560\ub97c \ub290\ub07c\uc9c0 \ubabb\ud569\ub2c8\ub2e4.**\\n\\n---\\n\\n### \uc0ac\ub840 2: \ubc30\uce58 \uc11c\ubc84 \uc7a5\uc560\\n\\n**\uc0c1\ud669**\\n- \ud558\ub8e8\uc5d0 \ud55c \ubc88 \uc2e4\ud589\ub418\ub294 \ubc30\uce58 \uc791\uc5c5\uc774 \uc11c\ubc84 1\ub300\uc5d0\uc11c \uc218\ud589\ub429\ub2c8\ub2e4.\\n\\n**\ubb38\uc81c**\\n- \ubc30\uce58 \uc2e4\ud589 \uc911 \uc11c\ubc84\uac00 \ub2e4\uc6b4\ub418\uba74 \uc791\uc5c5\uc774 \uc2e4\ud328\ud569\ub2c8\ub2e4.\\n\\n#### \uace0\uac00\uc6a9\uc131 \uc801\uc6a9\\n\ubc30\uce58 \uc11c\ubc84\ub97c \ub2e4\uc911\ud654\ud558\uace0 Quartz Cluster \ub610\ub294 Kubernetes CronJob\uacfc \uac19\uc740 \ud074\ub7ec\uc2a4\ud130\ub9c1 \uae30\uc220\uc744 \ub3c4\uc785\ud569\ub2c8\ub2e4.\\n\\n\uc11c\ubc84 A\uc5d0 \uc7a5\uc560\uac00 \ubc1c\uc0dd\ud558\uba74 \uc11c\ubc84 B\uac00 \ub2e4\uc74c \uc2a4\ucf00\uc904\uc744 \ub300\uc2e0 \uc2e4\ud589\ud558\uc5ec \ubc30\uce58 \uc791\uc5c5\uc774 \ud2b9\uc815 \uc11c\ubc84\uc5d0 \uc885\uc18d\ub418\uc9c0 \uc54a\ub3c4\ub85d \ud569\ub2c8\ub2e4.\\n\\n---\\n\\n## \ub0b4\uacb0\ud568\uc131\uacfc \uace0\uac00\uc6a9\uc131\uc758 \ucc28\uc774\\n\\n| \uad6c\ubd84 | \ub0b4\uacb0\ud568\uc131 | \uace0\uac00\uc6a9\uc131 |\\n|---|---|---|\\n| \ucd08\uc810 | \uc7a5\uc560\ub97c \uacac\ub514\ub294 \ub2a5\ub825 | \uc7a5\uc560 \ud6c4 \ube60\ub978 \ubcf5\uad6c |\\n| \uad00\uc810 | \uc694\uccad \ucc98\ub9ac\uc758 \uc9c0\uc18d\uc131 | \uc11c\ube44\uc2a4 \uc911\ub2e8 \uc2dc\uac04 \ucd5c\uc18c\ud654 |\\n| \uc811\uadfc \ubc29\uc2dd | \uc124\uacc4 \uc911\uc2ec | \uc6b4\uc601 \ubc0f \uc778\ud504\ub77c \uc911\uc2ec |\\n| \ubaa9\ud45c | \uae30\ub2a5 \uc720\uc9c0 | \ucd5c\ub300\ud55c\uc758 \uc5c5\ud0c0\uc784 \ud655\ubcf4 |\\n\\n- \ub0b4\uacb0\ud568\uc131\uc740 \ud0c0\uc774\uc5b4\uac00 \ud391\ud06c \ub098\ub3c4 \uc608\ube44 \ud0c0\uc774\uc5b4\ub85c \uacc4\uc18d \uc8fc\ud589\ud558\ub294 \uc790\ub3d9\ucc28\uc640 \uac19\uc2b5\ub2c8\ub2e4.\\n- \uace0\uac00\uc6a9\uc131\uc740 \uc0ac\uace0\uac00 \ub098\uba74 \uc989\uc2dc \ub2e4\ub978 \ucc28\ub7c9\uc73c\ub85c \uac08\uc544\ud0c0\ub294 \ub80c\ud130\uce74 \uc11c\ube44\uc2a4\uc640 \uac19\uc2b5\ub2c8\ub2e4.\\n\\n---\\n\\n## \uc2e4\ubb34\uc5d0\uc11c \ub0b4\uacb0\ud568\uc131\uacfc \uace0\uac00\uc6a9\uc131\uc758 \ubcd1\ud589 \uc801\uc6a9\\n\\n**\ub0b4\uacb0\ud568\uc131\uacfc \uace0\uac00\uc6a9\uc131\uc740 \uc11c\ub85c \uacbd\uc7c1\ud558\ub294 \uac1c\ub150\uc774 \uc544\ub2c8\ub77c \uc0c1\ud638 \ubcf4\uc644\uc801\uc778 \uad00\uacc4\uc785\ub2c8\ub2e4.**\\n\\n### \uc0ac\ub840: \ucd94\ucc9c \uc11c\ube44\uc2a4 \uc7a5\uc560 \ub300\uc751\\n\\n- \ub0b4\uacb0\ud568\uc131 \uce21\uba74\uc5d0\uc11c\ub294 \ucd94\ucc9c \uc11c\ubc84 \uc7a5\uc560 \uc2dc \uae30\ubcf8 \ucd94\ucc9c \ubaa9\ub85d\uc744 \uc81c\uacf5\ud558\uc5ec \uc11c\ube44\uc2a4 \uc5f0\uc18d\uc131\uc744 \uc720\uc9c0\ud569\ub2c8\ub2e4.\\n- \uace0\uac00\uc6a9\uc131 \uce21\uba74\uc5d0\uc11c\ub294 \uc7a5\uc560 \uc778\uc2a4\ud134\uc2a4\ub97c \uc790\ub3d9\uc73c\ub85c \uc81c\uac70\ud558\uace0 \uc2e0\uaddc \uc778\uc2a4\ud134\uc2a4\ub97c \uc2e0\uc18d\ud788 \uc0dd\uc131\ud558\uc5ec \ube60\ub978 \ubcf5\uad6c\ub97c \uc9c0\uc6d0\ud569\ub2c8\ub2e4.\\n\\n**\uacb0\uacfc\uc801\uc73c\ub85c \uc7a5\uc560\ub97c \uacac\ub514\uba74\uc11c \ub3d9\uc2dc\uc5d0 \ube60\ub974\uac8c \ubcf5\uad6c\ud558\ub294 \uc2dc\uc2a4\ud15c\uc744 \uad6c\ud604\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.**\\n\\n---\\n\\n## \ud604\uc2e4\uc801\uc778 \uc124\uacc4 \uc804\ub7b5\\n\\n\ubaa8\ub4e0 \uae30\ub2a5\uc744 \uc644\ubcbd\ud55c \ub0b4\uacb0\ud568\uc131\uc73c\ub85c \uc124\uacc4\ud558\uba74 \ube44\uc6a9\uacfc \uc2dc\uc2a4\ud15c \ubcf5\uc7a1\ub3c4\uac00 \ud06c\uac8c \uc99d\uac00\ud569\ub2c8\ub2e4. \ub530\ub77c\uc11c \uc2e4\ubb34\uc5d0\uc11c\ub294 \ub2e4\uc74c\uacfc \uac19\uc740 \uc804\ub7b5\uc744 \uad8c\uc7a5\ud569\ub2c8\ub2e4.\\n\\n- \ud575\uc2ec \ube44\uc988\ub2c8\uc2a4 \ud750\ub984\uc5d0\ub294 \uac15\ub825\ud55c \ub0b4\uacb0\ud568\uc131\uc744 \uc801\uc6a9\ud55c\ub2e4.\\n- \ubd80\uac00 \uae30\ub2a5\uc5d0\ub294 \uace0\uac00\uc6a9\uc131\uacfc \uc810\uc9c4\uc801 \uc11c\ube44\uc2a4 \uc800\ud558(Graceful Degradation)\ub97c \uc801\uc6a9\ud55c\ub2e4.\\n\\n---\\n\\n## \ub9c8\uce58\uba70\\n\\n**\ub0b4\uacb0\ud568\uc131\uc740 \uc7a5\uc560 \ubc1c\uc0dd \uc2dc\uc5d0\ub3c4 \uc694\uccad \ucc98\ub9ac\ub97c \uc9c0\uc18d\ud560 \uc218 \uc788\ub294 \ub2a5\ub825\uc774\uba70, \uace0\uac00\uc6a9\uc131\uc740 \uc7a5\uc560 \ubc1c\uc0dd \ud6c4 \ube60\ub978 \ubcf5\uad6c\ub97c \ud1b5\ud574 \uc11c\ube44\uc2a4 \uc911\ub2e8 \uc2dc\uac04\uc744 \ucd5c\uc18c\ud654\ud558\ub294 \uac1c\ub150\uc785\ub2c8\ub2e4.** \uc2e4\ubb34\uc5d0\uc11c\ub294 \ub450 \uac1c\ub150\uc744 \ud568\uaed8 \uc801\uc6a9\ud558\uc5ec \uc11c\ube44\uc2a4\uc758 \uc5f0\uc18d\uc131\uacfc \uc548\uc815\uc131\uc744 \ud655\ubcf4\ud569\ub2c8\ub2e4.\\n\\n\ubd84\uc0b0 \uc2dc\uc2a4\ud15c\uc5d0\uc11c\ub294 \uc7a5\uc560\ub97c \uc644\uc804\ud788 \uc81c\uac70\ud558\ub294 \uac83\uc740 \ud604\uc2e4\uc801\uc73c\ub85c \ubd88\uac00\ub2a5\ud569\ub2c8\ub2e4. \uc911\uc694\ud55c \uac83\uc740 \uc7a5\uc560\ub97c \uc5b4\ub5bb\uac8c \uacac\ub514\uace0, \uc5bc\ub9c8\ub098 \uc2e0\uc18d\ud558\uac8c \ubcf5\uad6c\ud558\ub294\uac00 \uc785\ub2c8\ub2e4. \ub0b4\uacb0\ud568\uc131\uacfc \uace0\uac00\uc6a9\uc131\uc744 \uc815\ud655\ud788 \uc774\ud574\ud558\uace0 \uc801\uc808\ud788 \uc801\uc6a9\ud558\ub294 \uac83\uc774 \uc548\uc815\uc801\uc778 \uc2dc\uc2a4\ud15c \uc124\uacc4\uc758 \ucd9c\ubc1c\uc810\uc785\ub2c8\ub2e4."},{"id":"kafka-exactly-once","metadata":{"permalink":"/blog/kafka-exactly-once","source":"@site/blog/2025-07-02-kafka-exactly-once.mdx","title":"Outbox \ud328\ud134\uc73c\ub85c Kafka Exactly-Once\uc5d0 \uac00\uae4c\uc6cc\uc9c0\uae30","description":"\uc774\ubc88 \ud3ec\uc2a4\ud2b8\uc5d0\uc11c\ub294 Debezium(CDC)\uc744 \uc0ac\uc6a9\ud558\uc9c0 \uc54a\uace0,","date":"2025-07-02T00:00:00.000Z","tags":[{"inline":false,"label":"Kafka","permalink":"/blog/tags/kafka","description":"Kafka tag description"}],"readingTime":6.55,"hasTruncateMarker":true,"authors":[{"name":"Johny Cho","title":"Back End Engineer @ NHN","url":"https://github.com/johnycho","page":{"permalink":"/blog/authors/johnycho"},"socials":{"github":"https://github.com/johnycho","instagram":"https://www.instagram.com/johny__cho","linkedin":"https://www.linkedin.com/in/johny-cho/"},"imageURL":"https://github.com/johnycho.png","key":"johnycho"}],"frontMatter":{"slug":"kafka-exactly-once","title":"Outbox \ud328\ud134\uc73c\ub85c Kafka Exactly-Once\uc5d0 \uac00\uae4c\uc6cc\uc9c0\uae30","authors":["johnycho"],"tags":["kafka"]},"unlisted":false,"prevItem":{"title":"\ub0b4\uacb0\ud568\uc131(Fault Tolerance)\uacfc \uace0\uac00\uc6a9\uc131(High Availability) \uc81c\ub300\ub85c \uc774\ud574\ud558\uae30","permalink":"/blog/fault-tolerance-high-availability"},"nextItem":{"title":"Kafka \uba54\uc2dc\uc9c0 \uc804\ub2ec \ubcf4\uc7a5 (Delivery Semantics)","permalink":"/blog/kafka-delivery-semantics"}},"content":"\x3c!-- truncate --\x3e\\n<br /><br />\\n\\n\uc774\ubc88 \ud3ec\uc2a4\ud2b8\uc5d0\uc11c\ub294 **Debezium(CDC)\uc744 \uc0ac\uc6a9\ud558\uc9c0 \uc54a\uace0**,  \\nOutbox \ud328\ud134\uc744 \ud65c\uc6a9\ud574 **effectively exactly-once**\ub97c \ub2ec\uc131\ud558\ub294 \uad6c\uc870\ub97c \uc815\ub9ac\ud574\ubcf4\ub824\uace0 \ud569\ub2c8\ub2e4.\\n\\n\ubd84\uc0b0 \uc2dc\uc2a4\ud15c\uc5d0\uc11c  \\n**\u201c\uba54\uc2dc\uc9c0\ub97c \uc815\ud655\ud788 \ud55c \ubc88 \ucc98\ub9ac\ud55c\ub2e4(Exactly-Once)\u201d** \ub294 \uc694\uad6c\uc0ac\ud56d\uc740 \ub9e4\uc6b0 \ud754\ud558\uc9c0\ub9cc,  \\n\uc774\ub97c **end-to-end\ub85c \uc644\ubcbd\ud558\uac8c \ubcf4\uc7a5\ud558\ub294 \uac83\uc740 \ud604\uc2e4\uc801\uc73c\ub85c \uac70\uc758 \ubd88\uac00\ub2a5**\ud569\ub2c8\ub2e4.\\n\\nKafka, DB, \uc678\ubd80 API\ub294 \uac01\uac01 \ub3c5\ub9bd\uc801\uc778 \uc2dc\uc2a4\ud15c\uc774\uba70  \\n\uc774\ub4e4\uc744 \ud558\ub098\uc758 \ud2b8\ub79c\uc7ad\uc158\uc73c\ub85c \ubb36\uc744 \uc218 \uc5c6\uae30 \ub54c\ubb38\uc785\ub2c8\ub2e4.\\n\\n\uadf8\ub798\uc11c \uc2e4\ubb34\uc5d0\uc11c\ub294 \ubcf4\ud1b5 \ub2e4\uc74c\uc744 \ubaa9\ud45c\ub85c \ud569\ub2c8\ub2e4.\\n\\n> **\uc911\ubcf5\uc740 \ud5c8\uc6a9\ud558\ub418,  \\n> \ucd5c\uc885 \ube44\uc988\ub2c8\uc2a4 \uacb0\uacfc(effect)\ub294 \uc815\ud655\ud788 \ud55c \ubc88\ub9cc \ubc18\uc601\ub418\ub3c4\ub85d \uc124\uacc4\ud55c\ub2e4.**\\n\\n## 1. \ubb38\uc81c \ubc30\uacbd\\n### DB update \u2192 Kafka produce\\n\uc774 \uad6c\uc870\uc5d0\uc11c\ub294 \ub2e4\uc74c \ubb38\uc81c\uac00 \ubc1c\uc0dd\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.\\n- DB\ub294 \ubc18\uc601\ub410\uc9c0\ub9cc Kafka \ubc1c\ud589 \uc2e4\ud328 \u2192 \uc774\ubca4\ud2b8 \uc720\uc2e4\\n- Kafka\ub294 \ubc1c\ud589\ub410\uc9c0\ub9cc DB \ud2b8\ub79c\uc7ad\uc158 \ub864\ubc31 \u2192 \uc798\ubabb\ub41c \uc774\ubca4\ud2b8 \uc804\ud30c\\n- \ub124\ud2b8\uc6cc\ud06c \uc7a5\uc560\ub85c \uc131\uacf5/\uc2e4\ud328 \uc5ec\ubd80\ub97c \uc54c \uc218 \uc5c6\uc74c\\n\\n\u27a1\ufe0f **DB\uc640 Kafka \uc0ac\uc774\uc758 \uc815\ud569\uc131\uc774 \uae68\uc9d0**\\n\\n---\\n\\n## 2. Outbox \ud328\ud134 \uac1c\uc694\\n\\nOutbox \ud328\ud134\uc758 \ud575\uc2ec \uc544\uc774\ub514\uc5b4\ub294 \ub2e8\uc21c\ud569\ub2c8\ub2e4.\\n> **\uc774\ubca4\ud2b8 \ubc1c\ud589\uc744 DB \ud2b8\ub79c\uc7ad\uc158\uc758 \uc77c\ubd80\ub85c \ub9cc\ub4e0\ub2e4.**\\n\\n\uc989,\\n- \ube44\uc988\ub2c8\uc2a4 \ub370\uc774\ud130 \ubcc0\uacbd\\n- \ubc1c\ud589\ud560 \uc774\ubca4\ud2b8 \uae30\ub85d\\n\\n\uc744 **\uac19\uc740 \ud2b8\ub79c\uc7ad\uc158 \uc548\uc5d0\uc11c \ucc98\ub9ac**\ud569\ub2c8\ub2e4.\\n\\nKafka \ubc1c\ud589\uc740 \uc774\ud6c4 **\ube44\ub3d9\uae30 Relay(\ubc30\uce58/\uc2a4\ucf00\uc904\ub7ec)**\uac00 \ub2f4\ub2f9\ud569\ub2c8\ub2e4.\\n\\n---\\n\\n## 3. \uc804\uccb4 \uc544\ud0a4\ud14d\ucc98 \ud750\ub984\\n\\n### 1) Producer (Application)\\n- \ube44\uc988\ub2c8\uc2a4 \ub85c\uc9c1 \uc218\ud589\\n- Outbox \ud14c\uc774\ube14\uc5d0 \uc774\ubca4\ud2b8 INSERT\\n- \ud558\ub098\uc758 DB \ud2b8\ub79c\uc7ad\uc158\uc73c\ub85c \ucee4\ubc0b\\n\\n\uc774 \ub2e8\uacc4\uc5d0\uc11c:\\n- Kafka \uc7a5\uc560\uc640 \ubb34\uad00\ud558\uac8c \uc774\ubca4\ud2b8\ub294 DB\uc5d0 \uc548\uc804\ud558\uac8c \uc800\uc7a5\ub41c\ub2e4\\n- \uc560\ud50c\ub9ac\ucf00\uc774\uc158 \uc7a5\uc560\uac00 \ubc1c\uc0dd\ud574\ub3c4 \uc774\ubca4\ud2b8 \uc720\uc2e4\uc740 \uc5c6\ub2e4\\n\\n---\\n\\n### 2) Outbox Relay (\ud3f4\ub9c1 \uae30\ubc18)\\n\\n- Outbox \ud14c\uc774\ube14\uc5d0\uc11c `PENDING` \uc0c1\ud0dc \uc774\ubca4\ud2b8 \uc870\ud68c\\n- Kafka\ub85c \uba54\uc2dc\uc9c0 \ubc1c\ud589\\n- \uc131\uacf5 \uc2dc `SENT` \uc0c1\ud0dc\ub85c \ubcc0\uacbd\\n- \uc2e4\ud328 \uc2dc \uc7ac\uc2dc\ub3c4\\n\\n\uc774 \uacfc\uc815\uc5d0\uc11c:\\n\\n- \ub124\ud2b8\uc6cc\ud06c \uc624\ub958, Kafka \uc7a5\uc560\ub85c \ubc1c\ud589 \uc2e4\ud328 \uac00\ub2a5\\n- \ud0c0\uc784\uc544\uc6c3\uc73c\ub85c \uc778\ud55c **\uc911\ubcf5 \ubc1c\ud589 \uac00\ub2a5\uc131 \uc874\uc7ac**\\n- \ub300\uc2e0 <mark>**\ucd5c\uc18c \ud55c \ubc88(at-least-once) \ubc1c\ud589\uc740 \ubcf4\uc7a5**</mark>\\n\\n---\\n\\n### 3) Consumer\\n\\n- Kafka \uba54\uc2dc\uc9c0 \uc18c\ube44\\n- `eventId` \uae30\uc900\uc73c\ub85c \uc774\ubbf8 \ucc98\ub9ac\ub41c \uc774\ubca4\ud2b8\uc778\uc9c0 \ud655\uc778\\n- \ucc98\uc74c \ucc98\ub9ac\ud558\ub294 \uc774\ubca4\ud2b8\ub9cc \ube44\uc988\ub2c8\uc2a4 \ub85c\uc9c1 \uc218\ud589\\n- \ucc98\ub9ac \uc774\ub825 DB\uc5d0 \uae30\ub85d\\n\\n\uba54\uc2dc\uc9c0\ub294 \uc911\ubcf5 \uc18c\ube44\ub420 \uc218 \uc788\uc9c0\ub9cc,  \\nDB \uba71\ub4f1 \ucc98\ub9ac\ub85c **\ube44\uc988\ub2c8\uc2a4 \uacb0\uacfc\ub294 \uc815\ud655\ud788 \ud55c \ubc88\ub9cc \ubc18\uc601**\ub429\ub2c8\ub2e4.\\n\\n---\\n\\n## 4. Outbox \ud14c\uc774\ube14 \uc608\uc2dc\\n\\n- `id` (PK)\\n- `event_id` (\uc804\uc5ed \uc720\uc77c)\\n- `payload`\\n- `status` (`PENDING`, `SENT`)\\n- `created_at`\\n\\n\uc2e4\ubb34\uc5d0\uc11c\ub294 Outbox row\ub97c \uc989\uc2dc DELETE\ud558\uae30\ubcf4\ub2e4  \\n`SENT` \uc0c1\ud0dc\ub85c \ub0a8\uae34 \ub4a4 TTL \ub610\ub294 \ubc30\uce58\ub85c \uc815\ub9ac\ud558\ub294 \ubc29\uc2dd\uc774 \ub354 \uc548\uc804\ud569\ub2c8\ub2e4.  \\n(\uac10\uc0ac \ub85c\uadf8, \uc7ac\ucc98\ub9ac, \ub9ac\ud50c\ub808\uc774 \ub300\uc751)\\n\\n---\\n\\n## 5. Consumer \uba71\ub4f1 \ucc98\ub9ac \ubc29\uc2dd\\n\\nConsumer\ub294 \ubc18\ub4dc\uc2dc **\uc911\ubcf5 \ucc98\ub9ac\ub97c \ubc29\uc9c0**\ud574\uc57c \ud569\ub2c8\ub2e4.\\n\\n\ub300\ud45c\uc801\uc778 \ubc29\ubc95:\\n\\n- `processed_event` \ud14c\uc774\ube14\uc5d0 `event_id`\ub97c PK\ub85c \uc800\uc7a5\\n- \ub610\ub294 \ube44\uc988\ub2c8\uc2a4 \ud14c\uc774\ube14\uc5d0 `event_id UNIQUE` \uc81c\uc57d \ucd94\uac00\\n\\n\uc774\ub807\uac8c \ud558\uba74:\\n\\n- \ub3d9\uc77c \uba54\uc2dc\uc9c0\uac00 \uc5ec\ub7ec \ubc88 \uc640\ub3c4\\n- DB \ubc18\uc601\uc740 **\ub2e8 \ud55c \ubc88\ub9cc \ubc1c\uc0dd**\\n\\n---\\n\\n## 6. \uc774 \uad6c\uc870\uac00 \ubcf4\uc7a5\ud558\ub294 \uc218\uc900\\n\\n| \uad6c\uac04 | \ubcf4\uc7a5 \uc218\uc900 |\\n|---|---|\\n| DB \u2192 Outbox | Exactly-once |\\n| Outbox \u2192 Kafka | At-least-once |\\n| Kafka \u2192 Consumer | At-least-once |\\n| \ucd5c\uc885 \ube44\uc988\ub2c8\uc2a4 \uacb0\uacfc | Effectively exactly-once |\\n\\n\uc989,\\n> **\uc804\ub2ec\uc740 \ucd5c\uc18c \ud55c \ubc88,  \\n> \uacb0\uacfc\ub294 \uc815\ud655\ud788 \ud55c \ubc88**\\n\\n---\\n\\n## 7. \uc65c \u201c\uc644\uc804\ud55c Exactly-Once\u201d\uac00 \uc544\ub2d0\uae4c?\\n\\n- Kafka \ubc1c\ud589\uc740 \uc911\ubcf5\ub420 \uc218 \uc788\ub2e4\\n- Consumer\ub294 \uc7ac\ucc98\ub9ac\ub420 \uc218 \uc788\ub2e4\\n- \ub124\ud2b8\uc6cc\ud06c \uc7a5\uc560\ub85c \uc131\uacf5 \uc5ec\ubd80\ub97c \ud655\uc815\ud560 \uc218 \uc5c6\ub2e4\\n\\n\ub530\ub77c\uc11c \ubb3c\ub9ac\uc801\uc778 \uc758\ubbf8\uc758 `Exactly-once`\ub294 \uc544\ub2d9\ub2c8\ub2e4.\\n\\n\ud558\uc9c0\ub9cc,\\n\\n- `eventId` \uae30\ubc18 \uba71\ub4f1 \ucc98\ub9ac\\n- \uc720\ub2c8\ud06c \uc81c\uc57d\\n- \ucc98\ub9ac \uc774\ub825 \uad00\ub9ac\\n\\n\ub97c \ud1b5\ud574 **\ube44\uc988\ub2c8\uc2a4 \uad00\uc810\uc5d0\uc11c\ub294 `Exactly-once`\uc640 \ub3d9\uc77c\ud55c \ud6a8\uacfc**\ub97c \uc5bb\uac8c\ub429\ub2c8\ub2e4.\\n\\n---\\n\\n## 8. \uc8fc\uc758\uc0ac\ud56d\\n\\n1. **`eventId` \uc124\uacc4\uac00 \uac00\uc7a5 \uc911\uc694**\\n    - \uc7ac\uc2dc\ub3c4/\uc7ac\ubc1c\ud589\uc5d0\ub3c4 \ub3d9\uc77c\ud574\uc57c \ud568\\n    - \uc804\uc5ed \uc720\uc77c\uc131 \ud544\uc218\\n\\n2. **\uc911\ubcf5 \ubc1c\ud589\uc740 \uc815\uc0c1 \ub3d9\uc791**\\n    - Consumer \uba71\ub4f1 \ucc98\ub9ac\ub294 \uc120\ud0dd\uc774 \uc544\ub2c8\ub77c \ud544\uc218\\n\\n3. **\uc678\ubd80 API \ud3ec\ud568 \uc2dc**\\n    - Idempotency-Key \uc9c0\uc6d0 \uc5ec\ubd80\uac00 \ud575\uc2ec\\n    - \uc5c6\uc73c\uba74 \ud638\ucd9c \ub85c\uadf8 + \uc7ac\uc2dc\ub3c4/\ubcf4\uc0c1 \ud2b8\ub79c\uc7ad\uc158 \ud544\uc694\\n\\n---\\n\\n## \ub9c8\uce58\uba70\\n\\n\ubd84\uc0b0 \uc2dc\uc2a4\ud15c\uc5d0\uc11c\\n\ubb3c\ub9ac\uc801\uc73c\ub85c \uc815\ud655\ud55c `Exactly-once`\ub97c end-to-end\ub85c \ubcf4\uc7a5\ud558\ub294 \uac83\uc740 \ud604\uc2e4\uc801\uc73c\ub85c \ubd88\uac00\ub2a5\ud569\ub2c8\ub2e4.\\n\\n\ub300\uc2e0 \uc2e4\ubb34\uc5d0\uc11c\ub294\\n\uc774\ubca4\ud2b8 \ubc1c\ud589 \uacfc\uc815\uc5d0\uc11c\uc758 \uc720\uc2e4\uc744 \ub9c9\uace0,\\n<mark>\uc911\ubcf5 \uc804\ub2ec\uc740 \ud5c8\uc6a9</mark>\ud558\ub418 <mark>\ube44\uc988\ub2c8\uc2a4 \uacb0\uacfc\ub294 \ud55c \ubc88\ub9cc \ubc18\uc601</mark>\ub418\ub3c4\ub85d \uc124\uacc4\ud558\ub294 \uac83\uc774 \ub354 \uc911\uc694\ud569\ub2c8\ub2e4.\\n\\n\uc774\ub97c \uc704\ud574\\nOutbox \ud328\ud134\uc73c\ub85c \uc774\ubca4\ud2b8 \ubc1c\ud589\uc744 \ucd5c\uc18c \ud55c \ubc88 \ubcf4\uc7a5\ud558\uace0,\\nConsumer\uc5d0\uc11c `eventId` \uae30\ubc18 \uba71\ub4f1 \ucc98\ub9ac\ub97c \uc801\uc6a9\ud568\uc73c\ub85c\uc368\\nend-to-end\ub85c\ub294 \uacb0\uacfc\uac00 \uc815\ud655\ud788 \ud55c \ubc88\ub9cc \ubc18\uc601\ub418\ub3c4\ub85d \uc124\uacc4\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.\\n\\n`Exactly-once`\ub294 \uc124\uc815\uc758 \ubb38\uc81c\uac00 \uc544\ub2c8\ub77c,\\n\uc5b4\ub514\uc5d0\uc11c \uc911\ubcf5\uc744 \ud5c8\uc6a9\ud558\uace0 \uc5b4\ub514\uc5d0\uc11c \ub9c9\uc744 \uac83\uc778\uc9c0\uc5d0 \ub300\ud55c \uc124\uacc4\uc758 \ubb38\uc81c\uc785\ub2c8\ub2e4."},{"id":"kafka-delivery-semantics","metadata":{"permalink":"/blog/kafka-delivery-semantics","source":"@site/blog/2025-07-01-kafka-delivery-semantics.mdx","title":"Kafka \uba54\uc2dc\uc9c0 \uc804\ub2ec \ubcf4\uc7a5 (Delivery Semantics)","description":"At-most-once / At-least-once / Exactly-once","date":"2025-07-01T00:00:00.000Z","tags":[{"inline":false,"label":"Kafka","permalink":"/blog/tags/kafka","description":"Kafka tag description"}],"readingTime":5.695,"hasTruncateMarker":true,"authors":[{"name":"Johny Cho","title":"Back End Engineer @ NHN","url":"https://github.com/johnycho","page":{"permalink":"/blog/authors/johnycho"},"socials":{"github":"https://github.com/johnycho","instagram":"https://www.instagram.com/johny__cho","linkedin":"https://www.linkedin.com/in/johny-cho/"},"imageURL":"https://github.com/johnycho.png","key":"johnycho"}],"frontMatter":{"slug":"kafka-delivery-semantics","title":"Kafka \uba54\uc2dc\uc9c0 \uc804\ub2ec \ubcf4\uc7a5 (Delivery Semantics)","authors":["johnycho"],"tags":["kafka"]},"unlisted":false,"prevItem":{"title":"Outbox \ud328\ud134\uc73c\ub85c Kafka Exactly-Once\uc5d0 \uac00\uae4c\uc6cc\uc9c0\uae30","permalink":"/blog/kafka-exactly-once"},"nextItem":{"title":"Kafka Producer/Consumer TraceId \ubd88\uc77c\uce58 \ubb38\uc81c \ud574\uacb0\uae30 (with OpenTelemetry)","permalink":"/blog/kafka-distributed-tracing"}},"content":"\x3c!-- truncate --\x3e\\n<br /><br />\\n\\n# \uba54\uc2dc\uc9c0 \uc804\ub2ec \ubcf4\uc7a5 (Delivery Semantics)\\n### `At-most-once` / `At-least-once` / `Exactly-once`\\n\\n\ubd84\uc0b0 \uc2dc\uc2a4\ud15c\uacfc \uba54\uc2dc\uc9c0 \ud050(Kafka, RabbitMQ \ub4f1)\ub97c \uc0ac\uc6a9\ud560 \ub54c  \\n\uac00\uc7a5 \uc911\uc694\ud55c \uc124\uacc4 \ud3ec\uc778\ud2b8 \uc911 \ud558\ub098\ub294 **\u201c\uba54\uc2dc\uc9c0\uac00 \uba87 \ubc88 \uc804\ub2ec\ub420 \uc218 \uc788\ub294\uac00\u201d** \uc785\ub2c8\ub2e4.\\n\\n\uc774\ub97c **\uba54\uc2dc\uc9c0 \uc804\ub2ec \ubcf4\uc7a5(Delivery Semantics)** \uc774\ub77c\uace0 \ud558\uba70, \ub300\ud45c\uc801\uc73c\ub85c \ub2e4\uc74c \uc138 \uac00\uc9c0\uac00 \uc788\uc2b5\ub2c8\ub2e4.\\n\\n---\\n\\n## 1. `At-most-once` (\ucd5c\ub300 \ud55c \ubc88 \uc804\ub2ec)\\n\\n### \uac1c\ub150\\n> \uba54\uc2dc\uc9c0\ub294 **\ucd5c\ub300 \ud55c \ubc88\ub9cc \ucc98\ub9ac**\ub418\uba70,  \\n> \uc2e4\ud328 \uc2dc \uba54\uc2dc\uc9c0\uac00 **\uc720\uc2e4\ub420 \uc218 \uc788\ub2e4**.\\n\\n- \uc911\ubcf5 \u274c\\n- \uc720\uc2e4 \u2b55\\n- \uc7ac\uc2dc\ub3c4 \u274c\\n\\n---\\n\\n### \ud2b9\uc9d5\\n\\n| \ud56d\ubaa9 | \uc124\uba85 |\\n|---|---|\\n| \uc2e0\ub8b0\uc131 | \ub0ae\uc74c |\\n| \uc131\ub2a5 | \ub9e4\uc6b0 \ub192\uc74c |\\n| \uad6c\ud604 \ub09c\uc774\ub3c4 | \ub9e4\uc6b0 \ub0ae\uc74c |\\n| \ucc98\ub9ac \uc18d\ub3c4 | \ucd5c\uc0c1 |\\n\\n\uba54\uc2dc\uc9c0\ub97c \ubc1b\uc790\ub9c8\uc790 \ucc98\ub9ac \uc644\ub8cc\ub85c \uac04\uc8fc\ud558\uac70\ub098,  \\n\ucc98\ub9ac \uc804\uc5d0 offset\uc744 \ucee4\ubc0b\ud558\ub294 \ubc29\uc2dd\uc5d0\uc11c \ubc1c\uc0dd\ud569\ub2c8\ub2e4.  \\n\uc774 \uacbd\uc6b0, \ucc98\ub9ac \uc911 \uc7a5\uc560\uac00 \ubc1c\uc0dd\ud558\uba74 \uc774\ubbf8 \ucee4\ubc0b\ub41c \uba54\uc2dc\uc9c0\ub294 \ub2e4\uc2dc \uc18c\ube44\ub418\uc9c0 \uc54a\uc544 \uba54\uc2dc\uc9c0 \uc720\uc2e4\uc774 \ubc1c\uc0dd\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.\\n\\n---\\n\\n### \uc5b8\uc81c \uc0ac\uc6a9\ud558\ub098?\\n\\n- \ub85c\uadf8 \uc218\uc9d1\\n- \ubaa8\ub2c8\ud130\ub9c1 \uc774\ubca4\ud2b8\\n- \ud2b8\ub798\ud53d \ubd84\uc11d\\n- \ud1b5\uacc4\uc131 \ub370\uc774\ud130 (\uc77c\ubd80 \uc720\uc2e4 \ud5c8\uc6a9)\\n\\n> \u201c\uc815\ud655\uc131\ubcf4\ub2e4 \uc18d\ub3c4\uac00 \uc911\uc694\ud55c \uacbd\uc6b0\u201d\\n\\n---\\n\\n### \uc608\uc2dc\\n\\n- \uc811\uc18d \ub85c\uadf8\\n- \ud074\ub9ad \ub85c\uadf8\\n- \uba54\ud2b8\ub9ad \ub370\uc774\ud130\\n\\n---\\n\\n## 2. `At-least-once` (\ucd5c\uc18c \ud55c \ubc88 \uc804\ub2ec)\\n\\n### \uac1c\ub150\\n> \uba54\uc2dc\uc9c0\ub294 **\ucd5c\uc18c \ud55c \ubc88 \uc774\uc0c1 \ucc98\ub9ac**\ub418\uba70,  \\n> \uc2e4\ud328 \uc2dc **\uc911\ubcf5 \ucc98\ub9ac**\uac00 \ubc1c\uc0dd\ud560 \uc218 \uc788\ub2e4.\\n\\n- \uc911\ubcf5 \u2b55\\n- \uc720\uc2e4 \u274c\\n- \uc7ac\uc2dc\ub3c4 \u2b55\\n\\n---\\n\\n### \ud2b9\uc9d5\\n\\n| \ud56d\ubaa9 | \uc124\uba85 |\\n|---|---|\\n| \uc2e0\ub8b0\uc131 | \ub192\uc74c |\\n| \uc131\ub2a5 | \uc911\uac04 |\\n| \uad6c\ud604 \ub09c\uc774\ub3c4 | \uc911\uac04 |\\n| \uc2e4\ubb34 \uc0ac\uc6a9 \ube48\ub3c4 | \ub9e4\uc6b0 \ub192\uc74c |\\n\\n\uba54\uc2dc\uc9c0 \ucc98\ub9ac \ud6c4 offset\uc744 \ucee4\ubc0b\ud558\uae30 \ub54c\ubb38\uc5d0  \\n\uc2e4\ud328 \uc2dc \uac19\uc740 \uba54\uc2dc\uc9c0\uac00 \ub2e4\uc2dc \ucc98\ub9ac\ub420 \uc218 \uc788\ub2e4.\\n\\n---\\n\\n### \uc5b8\uc81c \uc0ac\uc6a9\ud558\ub098?\\n\\n- \uc8fc\ubb38 \uc0dd\uc131\\n- \uacb0\uc81c \ucc98\ub9ac\\n- \ud478\uc2dc \ubc1c\uc1a1\\n- \ube44\uc988\ub2c8\uc2a4 \uc774\ubca4\ud2b8 \ucc98\ub9ac\\n\\n> \u201c\uc720\uc2e4\uc740 \uc808\ub300 \uc548 \ub418\uc9c0\ub9cc, \uc911\ubcf5\uc740 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc5d0\uc11c \ucc98\ub9ac\ud560 \uc218 \uc788\ub294 \uacbd\uc6b0\u201d\\n\\n---\\n\\n### \uc2e4\ubb34 \ud3ec\uc778\ud2b8\\n\\n\uc2e4\ubb34\uc5d0\uc11c\ub294 `At-least-once`\ub97c \uae30\ubcf8\uc73c\ub85c \uc0ac\uc6a9\ud558\uace0,  \\nConsumer \uce21\uc5d0\uc11c **eventId \uae30\ubc18 \uba71\ub4f1 \ucc98\ub9ac**\ub098  \\nDB \uc720\ub2c8\ud06c \uc81c\uc57d\uc744 \ud1b5\ud574 \uc911\ubcf5 \ucc98\ub9ac\ub97c \ubc29\uc9c0\ud558\ub294 \ubc29\uc2dd\uc774 \uac00\uc7a5 \uc77c\ubc18\uc801\uc785\ub2c8\ub2e4.\\n\\n\uc989, \uba54\uc2dc\uc9d5 \ub808\ubca8\uc740 `At-least-once`\ub85c \ub450\uace0  \\n\ube44\uc988\ub2c8\uc2a4 \ub85c\uc9c1\uc5d0\uc11c `Exactly-once`\uc5d0 \uac00\uae5d\uac8c \ub9cc\ub4dc\ub294 \uc804\ub7b5\uc744 \ucde8\ud569\ub2c8\ub2e4.\\n\\n---\\n\\n### \uc608\uc2dc\\n\\n- \uc8fc\ubb38 \uc774\ubca4\ud2b8 \ucc98\ub9ac\\n- \ud3ec\uc778\ud2b8 \uc801\ub9bd\\n- \uc774\uba54\uc77c \ubc1c\uc1a1 (\uc911\ubcf5 \ubc29\uc9c0 \ub85c\uc9c1 \ud3ec\ud568)\\n\\n---\\n\\n## 3. Exactly-once (\uc815\ud655\ud788 \ud55c \ubc88 \uc804\ub2ec)\\n\\n### \uac1c\ub150\\n> \uba54\uc2dc\uc9c0\ub294 **\uc911\ubcf5 \uc5c6\uc774 \uc815\ud655\ud788 \ud55c \ubc88\ub9cc \ucc98\ub9ac**\ub41c\ub2e4.\\n\\n- \uc911\ubcf5 \u274c\\n- \uc720\uc2e4 \u274c\\n- \ub192\uc740 \ube44\uc6a9\\n\\n---\\n\\n### \ud2b9\uc9d5\\n\\n| \ud56d\ubaa9 | \uc124\uba85 |\\n|---|---|\\n| \uc2e0\ub8b0\uc131 | \ucd5c\uace0 |\\n| \uc131\ub2a5 | \ub0ae\uc74c |\\n| \uad6c\ud604 \ub09c\uc774\ub3c4 | \ub192\uc74c |\\n| \uc6b4\uc601 \ubcf5\uc7a1\ub3c4 | \ub192\uc74c |\\n\\nKafka\uc758 \uacbd\uc6b0 **\ud2b8\ub79c\uc7ad\uc158**\uc744 \ud1b5\ud574,  \\n\uba54\uc2dc\uc9c0 \ucc98\ub9ac\uc640 offset commit\uc744 \ud558\ub098\uc758 \uc6d0\uc790\uc801 \uc791\uc5c5\uc73c\ub85c \ubb36\uc2b5\ub2c8\ub2e4.\\n\\n> \ub2e8, **Kafka \ub0b4\ubd80 \ubc94\uc704**\uc5d0\uc11c\ub9cc Exactly-once\uac00 \ubcf4\uc7a5\ub41c\ub2e4.\\n\\nKafka\uc758 `Exactly-once`\ub294  \\n**Producer \u2192 Kafka \u2192 Consumer \u2192 Kafka(offset commit)**  \\n\uae4c\uc9c0\uc758 \ubc94\uc704\uc5d0\uc11c\ub9cc \ubcf4\uc7a5\ub429\ub2c8\ub2e4.\\n\\n\uc989, DB\ub098 \uc678\ubd80 API\uae4c\uc9c0 \ud3ec\ud568\ud55c  \\nend-to-end `Exactly-once`\ub294 Kafka \ub2e8\ub3c5\uc73c\ub85c \ubcf4\uc7a5\ub418\uc9c0 \uc54a\uc73c\uba70,  \\n\uc774 \uacbd\uc6b0 Outbox \ud328\ud134, Idempotent Consumer \uc124\uacc4 \ub4f1\uc774 \ud544\uc694\ud569\ub2c8\ub2e4.\\n\\n---\\n\\n### \uc5b8\uc81c \uc0ac\uc6a9\ud558\ub098?\\n\\n- \uc815\ud655\ud55c \uc9d1\uacc4\\n- \uc2a4\ud2b8\ub9bc \ucc98\ub9ac\\n- \uae08\uc735/\uc815\uc0b0 \ud30c\uc774\ud504\ub77c\uc778\\n- Kafka Streams \uae30\ubc18 \ucc98\ub9ac\\n\\n> \u201c\uc911\ubcf5\uc774 \uce58\uba85\uc801\uc778 \uacbd\uc6b0\u201d\\n\\n---\\n\\n### \uc8fc\uc758\uc0ac\ud56d\\n\\n- DB, \uc678\ubd80 API\uae4c\uc9c0 \ud3ec\ud568\ud55c end-to-end Exactly-once\ub294 \ub9e4\uc6b0 \uc5b4\ub835\ub2e4\\n- \uc131\ub2a5 \ube44\uc6a9\uacfc \uc6b4\uc601 \ubcf5\uc7a1\ub3c4\ub97c \ubc18\ub4dc\uc2dc \uace0\ub824\ud574\uc57c \ud55c\ub2e4\\n\\n---\\n\\n## 4. \ud55c\ub208\uc5d0 \ube44\uad50\\n\\n| \uad6c\ubd84 | At-most-once | At-least-once | Exactly-once |\\n|---|---|---|---|\\n| \uba54\uc2dc\uc9c0 \uc720\uc2e4 | \uac00\ub2a5 | \ubd88\uac00\ub2a5 | \ubd88\uac00\ub2a5 |\\n| \uba54\uc2dc\uc9c0 \uc911\ubcf5 | \uc5c6\uc74c | \uac00\ub2a5 | \uc5c6\uc74c |\\n| \uc131\ub2a5 | \u2b50\u2b50\u2b50 | \u2b50\u2b50 | \u2b50 |\\n| \uad6c\ud604 \ub09c\uc774\ub3c4 | \ub0ae\uc74c | \uc911\uac04 | \ub192\uc74c |\\n| \uc2e4\ubb34 \uc0ac\uc6a9 | \ub0ae\uc74c | \u2b50\u2b50\u2b50\u2b50 | \uc81c\ud55c\uc801 |\\n\\n---\\n\\n## 5. \uc2e4\ubb34\uc5d0\uc11c\uc758 \uc120\ud0dd \uae30\uc900\\n\\n> **\u201cExactly-once\ub97c \uba3c\uc800 \uc4f0\uc9c0 \ub9d0\uace0,  \\n> At-least-once\ub85c \uc2dc\uc791\ud574 \ud544\uc694\ud55c \uacf3\uc5d0\ub9cc \uac15\ud654\ud558\uc790.\u201d**\\n\\n### \ucd94\ucc9c \uc804\ub7b5\\n- \uae30\ubcf8: **At-least-once**\\n- \ub85c\uadf8/\ubaa8\ub2c8\ud130\ub9c1: **At-most-once**\\n- \uc9d1\uacc4/\uc2a4\ud2b8\ub9bc: **Exactly-once (\uc81c\ud55c\uc801)**\\n\\n---\\n\\n## \ub9c8\ubb34\ub9ac\\n\\n\uba54\uc2dc\uc9c0 \uc804\ub2ec \ubcf4\uc7a5\uc740 \ub2e8\uc21c\ud55c \uc124\uc815 \ubb38\uc81c\uac00 \uc544\ub2c8\ub77c  \\n**\ube44\uc988\ub2c8\uc2a4 \ud2b9\uc131\uacfc \uc7a5\uc560 \ud5c8\uc6a9 \ubc94\uc704\uc5d0 \ub300\ud55c \uc124\uacc4 \uacb0\uc815**\uc785\ub2c8\ub2e4.\\n\\n- \uc720\uc2e4\uc774 \ud5c8\uc6a9\ub418\ub294\uac00?\\n- \uc911\ubcf5\uc774 \uce58\uba85\uc801\uc778\uac00?\\n- \uc131\ub2a5\uacfc \uc815\ud655\uc131 \uc911 \ubb34\uc5c7\uc774 \ub354 \uc911\uc694\ud55c\uac00?\\n\\n\uc774 \uc9c8\ubb38\uc5d0 \ub2f5\ud560 \uc218 \uc788\ub2e4\uba74 \uc801\uc808\ud55c \uc804\ub2ec \ubcf4\uc7a5\uc744 \uc120\ud0dd\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4."},{"id":"kafka-distributed-tracing","metadata":{"permalink":"/blog/kafka-distributed-tracing","source":"@site/blog/2025-06-06-kafka-distributed-tracing.mdx","title":"Kafka Producer/Consumer TraceId \ubd88\uc77c\uce58 \ubb38\uc81c \ud574\uacb0\uae30 (with OpenTelemetry)","description":"Spring Kafka\ub97c \uc0ac\uc6a9\ud558\ub294 \ub9c8\uc774\ud06c\ub85c\uc11c\ube44\uc2a4 \ud658\uacbd\uc5d0\uc11c, Kafka \uba54\uc2dc\uc9c0\ub97c \ud504\ub85c\ub4c0\uc11c\uc5d0\uc11c \ubcf4\ub0b4\uace0 \ucee8\uc288\uba38\uc5d0\uc11c \ubc1b\uc744 \ub54c \uc11c\ub85c \ub2e4\ub978 traceId\ub85c \uae30\ub85d\ub418\ub294 \uc774\uc288\uac00 \uc788\uc5c8\uc2b5\ub2c8\ub2e4.","date":"2025-06-06T00:00:00.000Z","tags":[{"inline":false,"label":"Kafka","permalink":"/blog/tags/kafka","description":"Kafka tag description"},{"inline":false,"label":"OpenTelemetry","permalink":"/blog/tags/open-telemetry","description":"OpenTelemetry tag description"}],"readingTime":8.91,"hasTruncateMarker":true,"authors":[{"name":"Johny Cho","title":"Back End Engineer @ NHN","url":"https://github.com/johnycho","page":{"permalink":"/blog/authors/johnycho"},"socials":{"github":"https://github.com/johnycho","instagram":"https://www.instagram.com/johny__cho","linkedin":"https://www.linkedin.com/in/johny-cho/"},"imageURL":"https://github.com/johnycho.png","key":"johnycho"}],"frontMatter":{"slug":"kafka-distributed-tracing","title":"Kafka Producer/Consumer TraceId \ubd88\uc77c\uce58 \ubb38\uc81c \ud574\uacb0\uae30 (with OpenTelemetry)","authors":["johnycho"],"tags":["kafka","open-telemetry"]},"unlisted":false,"prevItem":{"title":"Kafka \uba54\uc2dc\uc9c0 \uc804\ub2ec \ubcf4\uc7a5 (Delivery Semantics)","permalink":"/blog/kafka-delivery-semantics"},"nextItem":{"title":"Redis Spin Lock\uc5d0\uc11c Redisson \uae30\ubc18 \ubd84\uc0b0\ub77d\uc73c\ub85c \uac1c\uc120\ud558\uae30","permalink":"/blog/redis-distributed-lock"}},"content":"\x3c!-- truncate --\x3e\\n<br /><br />\\n\\nSpring Kafka\ub97c \uc0ac\uc6a9\ud558\ub294 \ub9c8\uc774\ud06c\ub85c\uc11c\ube44\uc2a4 \ud658\uacbd\uc5d0\uc11c, Kafka \uba54\uc2dc\uc9c0\ub97c \ud504\ub85c\ub4c0\uc11c\uc5d0\uc11c \ubcf4\ub0b4\uace0 \ucee8\uc288\uba38\uc5d0\uc11c \ubc1b\uc744 \ub54c <mark>\uc11c\ub85c \ub2e4\ub978 traceId</mark>\ub85c \uae30\ub85d\ub418\ub294 \uc774\uc288\uac00 \uc788\uc5c8\uc2b5\ub2c8\ub2e4.\\n\uc774\ubc88 \ud3ec\uc2a4\ud2b8\uc5d0\uc11c\ub294 \ud574\ub2f9 \uc774\uc288\uac00 \ubc1c\uc0dd\ud55c \uc6d0\uc778\uacfc \ud574\uacb0 \uacfc\uc815\uc5d0 \ub300\ud574\uc11c \uacf5\uc720\ud558\uace0\uc790 \ud569\ub2c8\ub2e4.\\n\\n## \uae30\uc874 \ucf54\ub4dc\\n```java\\n@Slf4j\\npublic class MdcKafkaProducerInterceptor<K, V> implements ProducerInterceptor<K, V> {\\n\\n  @Override\\n  public void configure(Map<String, ?> configs) {\\n    log.debug(\\"Configuring MdcKafkaProducerInterceptor with config: {}\\", configs);\\n  }\\n\\n  @Override\\n  public ProducerRecord<K, V> onSend(final ProducerRecord<K, V> rec) {\\n    final Headers headers = new RecordHeaders(rec.headers());\\n\\n    final String traceId = MDC.get(\\"traceId\\");\\n\\n    if (traceId != null) {\\n      headers.add(\\"traceId\\", traceId.getBytes(StandardCharsets.UTF_8));\\n    }\\n\\n    return new ProducerRecord<>(rec.topic(), rec.partition(), rec.timestamp(), rec.key(), rec.value(), headers);\\n  }\\n\\n  @Override\\n  public void onAcknowledgement(final RecordMetadata metadata, final Exception exception) {\\n    if (exception == null) {\\n      log.debug(\\"Message sent successfully: {}\\", metadata);\\n    } else {\\n      log.error(\\"Message send failed: {}\\", exception.getMessage(), exception);\\n    }\\n  }\\n\\n  @Override\\n  public void close() {\\n    log.info(\\"Closing MdcKafkaProducerInterceptor\\");\\n  }\\n}\\n```\\n```java\\n@Slf4j\\npublic class MdcKafkaConsumerInterceptor<K, V> implements ConsumerInterceptor<K, V> {\\n\\n  @Override\\n  public void configure(Map<String, ?> configs) {\\n    log.info(\\"Configuring MdcKafkaConsumerInterceptor with config: {}\\", configs);\\n  }\\n\\n  @Override\\n  public ConsumerRecords<K, V> onConsume(ConsumerRecords<K, V> records) {\\n    for (final ConsumerRecord<K, V> record : records) {\\n      final String traceId = findTraceId(record);\\n      if (traceId != null) {\\n        MDC.put(\\"traceId\\", traceId);\\n        MDC.put(\\"spanId\\", SpanId.fromLong(DataKeyGenerator.generateNumericId()));\\n      }\\n    }\\n    return records;\\n  }\\n\\n  @Override\\n  public void onCommit(Map<TopicPartition, OffsetAndMetadata> offsets) {\\n    log.info(\\"Committing offsets: {}\\", offsets);\\n  }\\n\\n  @Override\\n  public void close() {\\n    log.info(\\"Closing MdcKafkaConsumerInterceptor\\");\\n  }\\n\\n  @Nullable\\n  private static <K, V> String findTraceId(ConsumerRecord<K, V> record) {\\n    if (record.headers().lastHeader(\\"traceId\\") != null) {\\n      return record.headers().lastHeader(\\"traceId\\").toString();\\n    }\\n    return null;\\n  }\\n}\\n```\\n\\n### \ubb38\uc81c\uc810 1\\n\ud504\ub85c\ub4c0\uc11c \uc778\ud130\uc149\ud130\uc5d0\uc11c \ub808\ucf54\ub4dc \ub2e8\uc704\ub85c `traceId`\ub97c \uba54\uc2dc\uc9c0\uc5d0 \uc138\ud305\ud558\uace0\\n\ucee8\uc288\uba38 \uc778\ud130\uc149\ud130\uc5d0\uc11c \uba54\uc2dc\uc9c0\uc758 `traceId`\ub97c \ucd94\ucd9c\ud558\uc5ec `MDC`\uc5d0 \uc138\ud305\ud558\uace0 \uc788\ub294\ub370,\\n\ub2e4\uac74\uc758 \ub808\ucf54\ub4dc\uac00 \uc18c\ube44\ub418\ub294 \uacbd\uc6b0\uc5d0 \ud2b9\uc815 \ub808\ucf54\ub4dc\uc758 `traceId`\uac00 `MDC`\uc5d0 \uc138\ud305\ub418\uc5b4,\\n\ub3d9\uc77c\ud55c \ub808\ucf54\ub4dc\uc784\uc5d0\ub3c4 \ubd88\uad6c\ud558\uace0 \ud504\ub85c\ub4c0\uc11c-\ucee8\uc288\uba38 \uac04\uc5d0 `traceId`\uac00 \ub2e4\ub974\uac8c \uae30\ub85d\ub418\ub294 \ubb38\uc81c\uac00 \uc788\uc5c8\uc2b5\ub2c8\ub2e4.\\n\\n\ub610\ud55c, \uc11c\ube44\uc2a4 \ubc30\ud3ec\uc2dc \uc544\ub798\uc640 \uac19\uc774 OpenTelemetry Java Agent \ubc29\uc2dd(Agent Instrumentation)\uc744 \uc801\uc6a9\ud558\uace0 \uc788\ub294\ub370\\n```shell\\nexport JAVA_TOOL_OPTIONS=\\"-javaagent:/home/johny/apps/otel/opentelemetry-javaagent.jar\\"\\n```\\n\uc774 \uacbd\uc6b0 \uc790\ub3d9\uc73c\ub85c Kafka \uba54\uc2dc\uc9c0 \ud5e4\ub354\uc5d0 W3C `traceparent`\uac00 \uc8fc\uc785\ub418\uace0 \uc788\uc74c\uc5d0\ub3c4,  \\n\uc774\ub97c \ud65c\uc6a9\ud558\uc9c0 \uc54a\uace0 \ubcc4\ub3c4\ub85c `traceId`\ub97c \uba54\uc2dc\uc9c0\uc5d0 \ucd94\uac00\ub85c \uc138\ud305\ud558\uace0 \uc788\ub294\uac83\ub3c4 \ubb38\uc81c\uc600\uc2b5\ub2c8\ub2e4.\\n\\n### \ubb38\uc81c\uc810 2\\n\uae30\uc874\uc5d0\ub294 Kafka \ucee8\uc288\uba38\uc5d0\uc11c OpenTelemetry \ucee8\ud14d\uc2a4\ud2b8\ub97c \ucd94\ucd9c\ud558\ub294 \ub85c\uc9c1\uc774 \uc5c6\uc5c8\uc2b5\ub2c8\ub2e4.\\n\ud504\ub85c\ub4c0\uc11c\uc5d0\uc11c `traceparent` \ud5e4\ub354\ub97c \ud3ec\ud568\ud574 \uba54\uc2dc\uc9c0\ub97c \ubcf4\ub0b4\ub354\ub77c\ub3c4, \ucee8\uc288\uba38 \uce21\uc5d0\uc11c\ub294 \uc774\ub97c \uc778\uc2dd\ud558\uc9c0 \ubabb\ud558\uace0 \uc0c8\ub85c\uc6b4 `traceId`\ub85c \uc2a4\ud32c\uc744 \uc2dc\uc791\ud558\uac8c \ub418\uc5c8\uc2b5\ub2c8\ub2e4.\\n\\n## \ud574\uacb0 \ubc29\ubc95\\nKafka \uba54\uc2dc\uc9c0 \ud5e4\ub354\uc758 `traceparent`\ub97c \uc77d\uc5b4 OpenTelemetry \ucee8\ud14d\uc2a4\ud2b8\ub97c \ubcf5\uc6d0(\uc7ac\uad6c\uc131)\ud558\uace0, \uadf8 \ucee8\ud14d\uc2a4\ud2b8\ub97c \ud604\uc7ac \uc2a4\ub808\ub4dc\uc5d0 \uc801\uc6a9\ud558\ub294 \ub85c\uc9c1\uc744 \ucd94\uac00\ud588\uc2b5\ub2c8\ub2e4.\\n\uc774\ub97c \uc704\ud574 \uc138 \uac00\uc9c0 \ud575\uc2ec \ucef4\ud3ec\ub10c\ud2b8\ub97c \uad6c\ud604\ud588\uc2b5\ub2c8\ub2e4:\\n1. **MessageConsumer**: \ucee8\uc288\uba38 \uc778\ud130\ud398\uc774\uc2a4\uc5d0 \uacf5\ud1b5 \ud2b8\ub808\uc774\uc2f1 \ub85c\uc9c1 \ucd94\uac00\\n2. **OpenTelemetryKafkaTracer**: \ucee8\ud14d\uc2a4\ud2b8 \ucd94\ucd9c \ubc0f \uc2a4\ucf54\ud504 \uad00\ub9ac\\n3. **OpenTelemetryKafkaExtractor**: Kafka \ud5e4\ub354\uc5d0\uc11c `traceparent` \ucd94\ucd9c\\n\\n## \uad6c\ud604 \uc0c1\uc138\\n\\n### 1. MessageConsumer \uc778\ud130\ud398\uc774\uc2a4\\n\ubaa8\ub4e0 Kafka \ucee8\uc288\uba38\uac00 \uacf5\ud1b5\uc73c\ub85c \uc0ac\uc6a9\ud560 \uc218 \uc788\ub294 \uc778\ud130\ud398\uc774\uc2a4\ub97c \uc815\uc758\ud588\uc2b5\ub2c8\ub2e4.  \\n`consume` \uba54\uc11c\ub4dc\uc758 \uae30\ubcf8 \uad6c\ud604\uc5d0\uc11c `OpenTelemetryKafkaTracer`\ub97c \ud1b5\ud574 \uba54\uc2dc\uc9c0\ub97c \ucc98\ub9ac\ud569\ub2c8\ub2e4.\\n\\n```java\\npublic interface MessageConsumer<T> {\\n\\n  default void consume(final List<Message<T>> messages) {\\n    OpenTelemetryKafkaTracer.run(messages, this::processMessage);\\n  }\\n\\n  void processMessage(final Message<String> message);\\n}\\n```\\n\\n### 2. OpenTelemetryKafkaTracer\\n\uac01 \uba54\uc2dc\uc9c0\uc5d0 \ub300\ud574 \ucee8\ud14d\uc2a4\ud2b8\ub97c \ucd94\ucd9c\ud558\uace0, \ud574\ub2f9 \ucee8\ud14d\uc2a4\ud2b8\ub97c \ud604\uc7ac \uc2a4\ub808\ub4dc\uc5d0 \uc124\uc815\ud55c \ud6c4 \ube44\uc988\ub2c8\uc2a4 \ub85c\uc9c1\uc744 \uc2e4\ud589\ud569\ub2c8\ub2e4.  \\n`try-with-resources`\ub97c \uc0ac\uc6a9\ud574 \uc2a4\ucf54\ud504\uac00 \uc790\ub3d9\uc73c\ub85c \ub2eb\ud788\ub3c4\ub85d \ubcf4\uc7a5\ud569\ub2c8\ub2e4.\\n\\n```java\\nclass OpenTelemetryKafkaTracer {\\n  private OpenTelemetryKafkaTracer() {}\\n\\n  static <T> void run(final List<Message<T>> messages, final Consumer<Message<T>> task) {\\n    messages.forEach(msg -> processMessage(msg, task));\\n  }\\n\\n  private static <T> void processMessage(final Message<T> message, final Consumer<Message<T>> task) {\\n    final Context context = OpenTelemetryKafkaExtractor.extract(message);\\n    try (Scope ignored = context.makeCurrent()) {\\n      task.accept(message);\\n    }\\n  }\\n}\\n```\\n- `OpenTelemetryKafkaExtractor.extract(message)`: \uba54\uc2dc\uc9c0 \ud5e4\ub354\ub97c \uc77d\uc5b4 \ucee8\ud14d\uc2a4\ud2b8 \ucd94\ucd9c\\n- `context.makeCurrent()`: <mark>\ucd94\ucd9c\ud55c \ucee8\ud14d\uc2a4\ud2b8\ub97c \ud604\uc7ac \uc2a4\ub808\ub4dc\uc5d0 \uc124\uc815</mark>\\n- `try-with-resources`: \uc2a4\ucf54\ud504\uac00 \uc790\ub3d9\uc73c\ub85c \ub2eb\ud600 \uba54\ubaa8\ub9ac \ub204\uc218 \ubc29\uc9c0\\n\\n### 3. OpenTelemetryKafkaExtractor\\n\\nKafka \uba54\uc2dc\uc9c0 \ud5e4\ub354\uc5d0\uc11c `traceparent`\ub97c \ucd94\ucd9c\ud558\uc5ec OpenTelemetry `Context`\ub85c \ubcc0\ud658\ud569\ub2c8\ub2e4. Kafka native headers\ub97c \uc6b0\uc120\uc801\uc73c\ub85c \ud655\uc778\ud558\uace0, \uc5c6\uc744 \uacbd\uc6b0 Spring Message headers\uc5d0\uc11c \ucd94\ucd9c\ud569\ub2c8\ub2e4.\\n\\n```java\\npublic final class OpenTelemetryKafkaExtractor {\\n\\n  private static final String TRACE_PARENT = \\"traceparent\\";\\n\\n  private static final TextMapGetter<Headers> KAFKA_HEADERS_GETTER = new TextMapGetter<>() {\\n    @Override\\n    public Iterable<String> keys(final Headers carrier) {\\n      final List<String> keys = new ArrayList<>();\\n      carrier.forEach(h -> keys.add(h.key()));\\n      return keys;\\n    }\\n\\n    @Override\\n    public String get(final Headers carrier, @NonNull final String key) {\\n      if (Objects.isNull(carrier)) {\\n        return null;\\n      }\\n      final Header h = carrier.lastHeader(key);\\n      if (Objects.isNull(h) || Objects.isNull(h.value())) {\\n        return null;\\n      }\\n      return new String(h.value(), StandardCharsets.UTF_8);\\n    }\\n  };\\n\\n  private OpenTelemetryKafkaExtractor() {}\\n\\n  /**\\n   * Extracts an OpenTelemetry {@link Context} from a Spring {@link Message}.\\n   *\\n   * <p>Prefers native Kafka headers first (looking for {@code traceparent}) and\\n   * falls back to Spring message headers.</p>\\n   *\\n   * @param <T> the payload type of the message\\n   * @param message the message to read headers from; may be {@code null}\\n   * @return the extracted {@link Context}; if {@code message} is {@code null}, returns {@link Context#current()}\\n   */\\n  public static <T> Context extract(final Message<T> message) {\\n    if (Objects.isNull(message)) {\\n      return Context.current();\\n    }\\n    // 1) Kafka native headers \uc6b0\uc120\\n    final Object nativeHeaders = message.getHeaders().get(KafkaHeaders.NATIVE_HEADERS);\\n    if (nativeHeaders instanceof Headers headers && Objects.nonNull(headers.lastHeader(TRACE_PARENT))) {\\n      return GlobalOpenTelemetry.getPropagators()\\n                                .getTextMapPropagator()\\n                                .extract(Context.current(), headers, KAFKA_HEADERS_GETTER);\\n    }\\n    // 2) Fallback: Spring Message \ud5e4\ub354\uc5d0\uc11c \ucd94\ucd9c\\n    return GlobalOpenTelemetry.getPropagators()\\n                              .getTextMapPropagator()\\n                              .extract(Context.current(), message, springMessageGetter());\\n  }\\n\\n  private static <T> TextMapGetter<Message<T>> springMessageGetter() {\\n    return new TextMapGetter<>() {\\n      @Override\\n      public Iterable<String> keys(@NonNull final Message<T> carrier) {\\n        return carrier.getHeaders().keySet();\\n      }\\n\\n      @Override\\n      public String get(final Message<T> carrier, @NonNull final String key) {\\n        if (Objects.isNull(carrier)) {\\n          return null;\\n        }\\n        final Object v = carrier.getHeaders().get(key);\\n        if (Objects.isNull(v)) {\\n          return null;\\n        }\\n        if (v instanceof byte[] b) {\\n          return new String(b, StandardCharsets.UTF_8);\\n        }\\n        return v.toString();\\n      }\\n    };\\n  }\\n}\\n```\\n- Kafka native headers \uc6b0\uc120: `KafkaHeaders.NATIVE_HEADERS`\uc5d0\uc11c `traceparent` \ud5e4\ub354\ub97c \uba3c\uc800 \ud655\uc778\\n- Fallback \uba54\ucee4\ub2c8\uc998: Kafka native headers\uc5d0 \uc5c6\uc744 \uacbd\uc6b0 Spring Message headers\uc5d0\uc11c \ucd94\ucd9c\\n- TextMapGetter \uad6c\ud604: OpenTelemetry\uc758 \ud45c\uc900 \uc778\ud130\ud398\uc774\uc2a4\ub97c \uad6c\ud604\ud558\uc5ec \ud5e4\ub354 \uac12\uc744 \uc77d\uc74c\\n- \ubc14\uc774\ud2b8 \ubc30\uc5f4 \ucc98\ub9ac: Kafka \ud5e4\ub354\ub294 \ubc14\uc774\ud2b8 \ubc30\uc5f4\uc774\ubbc0\ub85c UTF-8\ub85c \ub514\ucf54\ub529\\n\\n## \uc2e4\uc81c \uc801\uc6a9 \uc608\uc2dc\\n\\n`SchedulerMessageConsumer`\ub294 `MessageConsumer` \uc778\ud130\ud398\uc774\uc2a4\ub97c \uad6c\ud604\ud558\uc5ec \uc790\ub3d9\uc73c\ub85c \ud2b8\ub808\uc774\uc2f1\uc774 \uc801\uc6a9\ub429\ub2c8\ub2e4.\\n\\n```java\\npublic class SchedulerMessageConsumer implements MessageConsumer<String> {\\n  private final ImmediatePushService immediatePushService;\\n\\n  @KafkaListener(topics = EventMessageConstants.TOPIC_SINGLE_PUSH_EXTRACT, batch = \\"false\\")\\n  public void consumeSingleMessage(final Message<String> message, final Acknowledgment acknowledgment) {\\n    try {\\n      consume(List.of(message));\\n    } catch (Exception e) {\\n      log.error(\\"fail kafka consume. topic: {}, message: {}\\", EventMessageConstants.TOPIC_SINGLE_PUSH_EXTRACT, message, e);\\n    } finally {\\n      acknowledgment.acknowledge();\\n    }\\n  }\\n\\n  @Override\\n  public void processMessage(final Message<String> message) {\\n    Optional.ofNullable(MessageUtil.deserialize(message, SinglePushExtractEventMessage.class))\\n            .ifPresent(dto -> {\\n              log.debug(\\"SinglePushExtractEvent. event={}\\", NscConfig.MAPPER.valueToTree(dto).toString());\\n              immediatePushService.execute(dto);\\n              ThreadUtil.sleep(200, TimeUnit.MILLISECONDS);\\n            });\\n  }\\n}\\n```\\n\\n### \ub3d9\uc791 \ud750\ub984\\n1. `@KafkaListener`\uac00 \uba54\uc2dc\uc9c0\ub97c \uc218\uc2e0\\n2. `consume(List.of(message))` \ud638\ucd9c \u2192 `MessageConsumer`\uc758 \uae30\ubcf8 \uad6c\ud604 \uc2e4\ud589\\n3. `OpenTelemetryKafkaTracer.run()` \u2192 \uba54\uc2dc\uc9c0 \ud5e4\ub354\ub97c \uc77d\uc5b4 \ucee8\ud14d\uc2a4\ud2b8 \ucd94\ucd9c \ubc0f \uc124\uc815\\n4. `processMessage()` \uc2e4\ud589 \u2192 \ucd94\ucd9c\ub41c \ucee8\ud14d\uc2a4\ud2b8 \ud558\uc5d0\uc11c \ube44\uc988\ub2c8\uc2a4 \ub85c\uc9c1 \uc218\ud589\\n5. \ubaa8\ub4e0 \uc2a4\ud32c\uc774 \ub3d9\uc77c\ud55c traceId\ub85c \uc5f0\uacb0\ub428\\n\\n---\\n\\n## \ub9c8\uce58\uba70\\nKafka \uae30\ubc18 \uc11c\ube44\uc2a4\uc5d0\uc11c TraceId \ubd88\uc77c\uce58\ub294 \ub300\ubd80\ubd84 \ube44\ud45c\uc900 \uc804\ud30c \ubc29\uc2dd(MDC \uae30\ubc18 \ucee4\uc2a4\ud140 \ud5e4\ub354)\uacfc\\nOpenTelemetry \ucee8\ud14d\uc2a4\ud2b8 \ucd94\ucd9c\xb7\uc801\uc6a9\uc758 \ubd80\uc7ac\uac00 \uacb0\ud569\ub420 \ub54c \ubc1c\uc0dd\ud569\ub2c8\ub2e4.\\n\\n\uc774\ubc88 \uac1c\uc120\uc744 \ud1b5\ud574\\n- `OpenTelemetry Java Agent`\uac00 \uc790\ub3d9\uc73c\ub85c \uc8fc\uc785\ud558\ub294 `W3C traceparent` \ud5e4\ub354\ub97c \ud45c\uc900 \uc804\ud30c \uc218\ub2e8\uc73c\ub85c \ud1b5\uc77c\ud558\uace0,\\n- Consumer \uce21\uc5d0\uc11c \ucee8\ud14d\uc2a4\ud2b8\ub97c \uc815\ud655\ud788 \ucd94\ucd9c\ud574 \uc2a4\ub808\ub4dc \ucee8\ud14d\uc2a4\ud2b8\ub85c \uc801\uc6a9\ud558\ub294 \ucc98\ub9ac \uacc4\uce35\uc744 \ub3c4\uc785\ud568\uc73c\ub85c\uc368\\n\\nProducer \u2192 Consumer \uc804 \uad6c\uac04\uc5d0\uc11c \uc77c\uad00\ub41c `TraceId`\uc640 `Span` \uad6c\uc870\ub97c \ud655\ubcf4\ud560 \uc218 \uc788\uc5c8\uace0,\\n\uadf8 \uacb0\uacfc \ubd84\uc0b0 \ud2b8\ub79c\uc7ad\uc158\uc758 \ucd94\uc801 \uc815\ud655\ub3c4, \uc7a5\uc560 \ubd84\uc11d \uc18d\ub3c4, \uba54\uc2dc\uc9c0 \ud750\ub984 \uac00\uc2dc\uc131\uc774 \ud06c\uac8c \uac1c\uc120\ub418\uc5c8\uc2b5\ub2c8\ub2e4."},{"id":"redis-distributed-lock","metadata":{"permalink":"/blog/redis-distributed-lock","source":"@site/blog/2025-05-01-redis-distributed-lock.mdx","title":"Redis Spin Lock\uc5d0\uc11c Redisson \uae30\ubc18 \ubd84\uc0b0\ub77d\uc73c\ub85c \uac1c\uc120\ud558\uae30","description":"\uc774\ubc88 \ud3ec\uc2a4\ud2b8\uc5d0\uc11c\ub294 Redis \uae30\ubc18\uc758 Spin Lock(SETNX + while-loop) \uad6c\uc870\ub97c Redisson \uae30\ubc18\uc758 Reentrant Distributed Lock\uc73c\ub85c \uc804\ud658\ud588\ub358 \uacbd\ud5d8\uc744 \uacf5\uc720\ud558\uace0\uc790 \ud569\ub2c8\ub2e4.","date":"2025-05-01T00:00:00.000Z","tags":[{"inline":false,"label":"Redis","permalink":"/blog/tags/redis","description":"Redis tag description"}],"readingTime":6.47,"hasTruncateMarker":true,"authors":[{"name":"Johny Cho","title":"Back End Engineer @ NHN","url":"https://github.com/johnycho","page":{"permalink":"/blog/authors/johnycho"},"socials":{"github":"https://github.com/johnycho","instagram":"https://www.instagram.com/johny__cho","linkedin":"https://www.linkedin.com/in/johny-cho/"},"imageURL":"https://github.com/johnycho.png","key":"johnycho"}],"frontMatter":{"slug":"redis-distributed-lock","title":"Redis Spin Lock\uc5d0\uc11c Redisson \uae30\ubc18 \ubd84\uc0b0\ub77d\uc73c\ub85c \uac1c\uc120\ud558\uae30","authors":["johnycho"],"tags":["redis"]},"unlisted":false,"prevItem":{"title":"Kafka Producer/Consumer TraceId \ubd88\uc77c\uce58 \ubb38\uc81c \ud574\uacb0\uae30 (with OpenTelemetry)","permalink":"/blog/kafka-distributed-tracing"},"nextItem":{"title":"Spring Cloud Config\uc758 \ubcf5\ud638\ud654 \uc2e4\ud328 \ucc98\ub9ac \uacfc\uc815 \u2014 {cipher}...\uac00 invalid.*\ub85c \ubc14\ub00c\ub294 \uc774\uc720","permalink":"/blog/spring-cloud-config-decrypt"}},"content":"\x3c!-- truncate --\x3e\\n<br /><br />\\n\\n\uc774\ubc88 \ud3ec\uc2a4\ud2b8\uc5d0\uc11c\ub294 Redis \uae30\ubc18\uc758 Spin Lock(`SETNX` + while-loop) \uad6c\uc870\ub97c `Redisson` \uae30\ubc18\uc758 `Reentrant Distributed Lock`\uc73c\ub85c \uc804\ud658\ud588\ub358 \uacbd\ud5d8\uc744 \uacf5\uc720\ud558\uace0\uc790 \ud569\ub2c8\ub2e4.\\n\\n## \uae30\uc874 Spin Lock \uad6c\uc870\\n```java\\npublic <T> T executeInSpinLock(String lockKey, Supplier<T> supplier) {\\n    while (Boolean.FALSE.equals(acquireLock(lockKey))) {\\n      log.info(\\"sleep to acquire distributed lock (lock key = {})\\", lockKey);\\n      ThreadUtil.sleep(100, TimeUnit.MILLISECONDS);\\n    }\\n\\n    try {\\n      return supplier.get();\\n    } catch (Exception e) {\\n      errorNotifier.sendErrorMessage(\\"error occurs in executing task in lock\\", e);\\n      throw e;\\n    } finally {\\n      eventPublisher.publishEvent(RedisUnlockEvent.of(lockKey));\\n    }\\n  }\\n\\n@TransactionalEventListener(phase = TransactionPhase.AFTER_COMPLETION, fallbackExecution = true)\\npublic void releaseLock(RedisUnlockEvent event) {\\n  if (lockContextHolder.isEmpty()) {\\n    return;\\n  }\\n\\n  retry(() -> {\\n    final Boolean releaseDistributedLock = redisTemplate.delete(event.getLockKey());\\n    if (Boolean.TRUE.equals(releaseDistributedLock)) {\\n      lockContextHolder.clear();\\n    }\\n    return null;\\n  });\\n}\\n\\nprivate Boolean acquireLock(String lockKey) {\\n  if (lockContextHolder.hasAlreadyAcquireDistributedLock(lockKey)) {\\n    log.info(\\"accessing the critical section within the same thread. (lock key = {})\\", lockKey);\\n    return true;\\n  }\\n\\n  return retry(() -> {\\n    final Boolean acquireDistributedLock = redisTemplate.opsForValue().setIfAbsent(lockKey, StringUtils.EMPTY, Duration.ofMinutes(1));\\n    if (Boolean.TRUE.equals(acquireDistributedLock)) {\\n      lockContextHolder.setValue(lockKey);\\n    }\\n    return acquireDistributedLock;\\n  });\\n}\\n\\nprivate <T> T retry(Supplier<T> supplier) {\\n  try {\\n    return retryTemplate.execute(context -> supplier.get());\\n  } catch (Exception e) {\\n    errorNotifier.sendErrorMessage(\\"fail in retry\\", e);\\n    throw e;\\n  }\\n}\\n```\\n\uae30\uc874 \ucf54\ub4dc\ub294 \ub2e4\uc74c\uacfc \uac19\uc740 \ubc29\uc2dd\uc73c\ub85c \ubd84\uc0b0\ub77d\uc744 \uad6c\ud604\ud558\uace0 \uc788\uc5c8\uc2b5\ub2c8\ub2e4.\\n- Redis `SETNX`(setIfAbsent) \u2192 \ub77d \ud68d\ub4dd\\n- \ub77d\uc744 \uc5bb\uc744 \ub54c\uae4c\uc9c0 `while(false)`\ub85c \ubc18\ubcf5 (100ms sleep)\\n- \ub77d\uc744 \ud68d\ub4dd\ud558\uba74 \ube44\uc988\ub2c8\uc2a4 \ub85c\uc9c1 \uc218\ud589\\n- \ud2b8\ub79c\uc7ad\uc158\uc774 \ub05d\ub09c \ub4a4(`AFTER_COMPLETION`) \uc774\ubca4\ud2b8 \uae30\ubc18\uc73c\ub85c \ub77d \ud574\uc81c\\n\\n\uc5ec\uae30\uc11c \ubb38\uc81c\uac00 \ub418\ub294 \ud575\uc2ec \uad6c\ud604\uc740 \uc544\ub798 \ubd80\ubd84\uc785\ub2c8\ub2e4.\\n```java\\nwhile (Boolean.FALSE.equals(acquireLock(lockKey))) {\\n    log.info(\\"sleep to acquire distributed lock (lock key = {})\\", lockKey);\\n    ThreadUtil.sleep(100, TimeUnit.MILLISECONDS);\\n}\\n```\\n\ub77d\uc744 \ud68d\ub4dd\ud558\ub294 \uacfc\uc815\uc5d0\uc11c \ub0b4\ubd80\uc801\uc73c\ub85c Redis\uc5d0 \ub2e4\uc74c\uacfc \uac19\uc740 \ucee4\ub9e8\ub4dc\ub97c \uacc4\uc18d \ub0a0\ub9bd\ub2c8\ub2e4.\\n```redis\\nSET key value NX EX 60\\n```\\n\ub77d\uc774 \uc774\ubbf8 \uc788\ub2e4\uba74 \u2192 \uc2e4\ud328 \u2192 sleep \u2192 \ub2e4\uc2dc `SETNX`  \\n\uc774 \uacfc\uc815\uc774 \ub77d\uc744 \uc5bb\uc744 \ub54c\uae4c\uc9c0 \ubb34\ud55c \ubc18\ubcf5\ub429\ub2c8\ub2e4.\\n\\n### \uae30\uc874 Spin Lock \uad6c\uc870\uc758 \ubb38\uc81c\uc810\\n1) Redis \ubd80\ud558 \uc99d\uac00 (Polling \uae30\ubc18 \uad6c\uc870)  \\n   \uc2a4\ub808\ub4dc\uac00 \uc7a0\ub4e4\uc5c8\ub2e4 \uae68\uba70 \ub9e4 100ms\ub9c8\ub2e4 `SETNX`\ub97c \ud638\ucd9c\ud568  \\n   \ud2b9\ud788 \ub77d\uc774 \uc624\ub798 \uc720\uc9c0\ub418\uba74, Redis\ub294 <mark>\ubd88\ud544\uc694\ud55c \ud2b8\ub798\ud53d\uc744 \uacc4\uc18d \ubc1b\uc74c</mark>\\n2) Spin Lock\uc740 <mark>CPU \ud6a8\uc728\uc774 \uc88b\uc9c0 \uc54a\uc74c</mark>  \\n   100ms sleep\uc744 \ud574\ub3c4 \uacb0\uad6d \ud3f4\ub9c1 \uae30\ubc18\uc774\ub77c, \ubd88\ud544\uc694\ud558\uac8c \uc2a4\ub808\ub4dc\ub97c \uae68\uc6b0\uace0 put/get\uc744 \ubc18\ubcf5\ud558\uac8c \ub428\\n3) \uc7ac\uc9c4\uc785(`Reentrant`) \ub77d\uc774 \uc544\ub2d8 \u2192 `ThreadLocal`\ub85c \uc5b5\uc9c0 \uad6c\ud604  \\n   \uc911\ucca9 \ud638\ucd9c\uc744 \uc9c0\uc6d0\ud558\uae30 \uc704\ud574 `LockContextHolder`\ub85c `ThreadLocal`\uc744 \ud65c\uc6a9\ud558\uc9c0\ub9cc \ud55c\uacc4\uc810 \uc874\uc7ac\\n   - \ub204\uc218 \uc704\ud5d8 \uc788\uc74c\\n   - \uc5ec\ub7ec \ud0a4\ub97c \ub3d9\uc2dc\uc5d0 \uc7a1\ub294 \uc0c1\ud669\uc5d0\uc11c \ud655\uc7a5\uc774 \uc5b4\ub824\uc6c0\\n   - `Redisson`\uc758 \uc7ac\uc9c4\uc785 \ub77d\uc5d0 \ube44\ud558\uba74 \uae30\ub2a5\uc801\uc73c\ub85c \ub9ce\uc774 \ubd80\uc871\ud568\\n4) \ub77d \ub9cc\ub8cc(expire)\uc640 \uc2e4\uc81c unlock \ud0c0\uc774\ubc0d\uc774 \ub9de\uc9c0 \uc54a\uc744 \uc704\ud5d8  \\n   <mark>\ud2b8\ub79c\uc7ad\uc158 \uae38\uc774\uac00 \uc608\uc0c1\ubcf4\ub2e4 \uae38\uc5b4\uc9c0\uba74 TTL(`SETNX` expire)\uc774 \uba3c\uc800 \ub9cc\ub8cc\ub420 \uc218 \uc788\uc74c</mark> (\ub77d \uc548\uc815\uc131\uc774 TTL\uc5d0 \ub108\ubb34 \uc758\uc874)\\n\\n## `Redisson` \uae30\ubc18 \ubd84\uc0b0\ub77d\uc73c\ub85c \uac1c\uc120\ud558\uae30\\n`Redisson`\uc740 \ub2e4\uc74c \uae30\ub2a5\uc744 \uae30\ubcf8 \uc9c0\uc6d0\ud569\ub2c8\ub2e4.\\n- Redis \uae30\ubc18 Reentrant Lock(\uc7ac\uc9c4\uc785 \uac00\ub2a5)\\n- Pub/Sub \uae30\ubc18 \ub77d \ub300\uae30 \u2192 Spin Lock \uc81c\uac70\\n- TTL + Watchdog \uae30\ubc18 \uc790\ub3d9 \uc5f0\uc7a5\\n- \ubd84\uc0b0 \ud658\uacbd\uc5d0\uc11c \uc548\uc804\ud558\uac8c \ub3d9\uc791\\n\\n### \ucd5c\uc885 \uac1c\uc120 \ucf54\ub4dc\\n```java\\n@Service\\n@RequiredArgsConstructor\\n@Slf4j\\npublic class RedissonDistributedLockService {\\n\\n  private final RedissonClient redissonClient;\\n  private final ApplicationEventPublisher eventPublisher;\\n  private final ErrorNotifier errorNotifier;\\n\\n  public <T> T executeWithRedissonLock(String lockKey, Supplier<T> supplier) {\\n    RLock lock = null;\\n\\n    try {\\n      lock = acquireLock(lockKey, 30, TimeUnit.SECONDS);\\n\\n      return supplier.get();\\n\\n    } catch (Exception e) {\\n      errorNotifier.sendErrorMessage(\\"error occurs in executing task in redisson lock\\", e);\\n      throw e;\\n\\n    } finally {\\n      // unlock\uc740 AFTER_COMPLETION\uc5d0\uc11c \uc2e4\ud589\\n      if (lock != null) {\\n        eventPublisher.publishEvent(RedissonUnlockEvent.of(lockKey));\\n      }\\n    }\\n  }\\n\\n  private RLock acquireLock(String lockKey, long leaseTime, TimeUnit unit) {\\n    RLock lock = redissonClient.getLock(lockKey);\\n    lock.lock(); // leaseTime \uc9c0\uc815 X (watchdog \ub3d9\uc791)\\n    // lock.lock(leaseTime, unit); // \ubb34\ud55c \ub300\uae30 + leaseTime\uc774 \uc9c0\ub098\uba74 \uac15\uc81c\ub85c \ub77d\uc774 \ud574\uc81c\ub428\\n    log.info(\\"acquired redisson lock. key={}\\", lockKey);\\n    return lock;\\n  }\\n\\n  @TransactionalEventListener(\\n      phase = TransactionPhase.AFTER_COMPLETION,\\n      fallbackExecution = true\\n  )\\n  public void releaseLock(RedissonUnlockEvent event) {\\n    RLock lock = redissonClient.getLock(event.getLockKey());\\n\\n    try {\\n      if (lock.isHeldByCurrentThread()) {\\n        lock.unlock();\\n        log.info(\\"released redisson lock. key={}\\", event.getLockKey());\\n      }\\n    } catch (Exception e) {\\n      log.error(\\"failed to unlock redisson lock. key={}\\", event.getLockKey(), e);\\n    }\\n  }\\n}\\n```\\n\\n### \uac1c\uc120 \uacb0\uacfc\\n1) <mark>Redis \ubd80\ud558 \uac10\uc18c</mark> (Polling \u2192 Pub/Sub \uae30\ubc18)  \\n   Spin Lock \uc81c\uac70\ub85c Redis \ud2b8\ub798\ud53d\uc774 \ud06c\uac8c \uac10\uc18c\\n2) \ub77d \ud68d\ub4dd \ud6a8\uc728 \uc99d\uac00  \\n   `Redisson`\uc740 Redis Pub/Sub \uc744 \ud65c\uc6a9\ud574 \uc774\ubca4\ud2b8 \uae30\ubc18\uc73c\ub85c \ub77d\uc744 \uae30\ub2e4\ub9bc  \\n   \u2192 \ub77d\uc774 \ud480\ub9b4 \ub54c\uae4c\uc9c0 \uc870\uc6a9\ud788 \ub300\uae30  \\n   \u2192 <mark>CPU \uc0ac\uc6a9\ub7c9 \uac10\uc18c</mark>\\n3) <mark>\uc7ac\uc9c4\uc785(Reentrant) \ub77d \ub0b4\uc7a5</mark> \u2192 `ThreadLocal` \uc81c\uac70  \\n   `Redisson`\uc758 \ub77d\uc740 \ub3d9\uc77c \uc2a4\ub808\ub4dc\uc5d0\uc11c \uc5ec\ub7ec \ubc88 \ud638\ucd9c\ud574\ub3c4 \uc790\ub3d9\uc73c\ub85c hold count \uad00\ub9ac  \\n   \u2192 `ThreadLocal` \uad00\ub9ac \ucf54\ub4dc \uc644\uc804\ud788 \uc81c\uac70  \\n   \u2192 \ub77d \uc548\uc815\uc131 \uc99d\uac00  \\n   \u2192 \uc911\ucca9 \uad6c\uc870\ub3c4 \uc27d\uac8c \ud45c\ud604 \uac00\ub2a5\\n4) Watchdog \uc0ac\uc6a9 \ud328\ud134(TTL\uc790\ub3d9 \uc5f0\uc7a5)\uc73c\ub85c \uc548\uc815\uc131 \uc99d\uac00  \\n   `Redisson` lock\uc740 <mark>watchdog\uc744 \ud1b5\ud574 \ub77d\uc744 \uc8fc\uae30\uc801\uc73c\ub85c \uc5f0\uc7a5</mark>\ud560 \uc218 \uc788\uc74c  \\n   \ube44\uc988\ub2c8\uc2a4 \ub85c\uc9c1\uc774 \uae38\uc5b4\uc838\ub3c4 \ub77d\uc774 \uba3c\uc800 expire\ub418\uc9c0 \uc54a\uc544 \ud2b8\ub79c\uc7ad\uc158 \ub3d9\uc548\uc5d0 \ub77d\uc774 \uc720\uc9c0\ub428  \\n   \u2192 \uc2a4\ub808\ub4dc\uac00 \uc0b4\uc544\uc788\ub294 \ub3d9\uc548 \ud2b8\ub79c\uc7ad\uc158 \ub05d\ub0a0 \ub54c\uae4c\uc9c0 watchdog\uc774 \uacc4\uc18d \ub77d\uc744 \uc720\uc9c0\\n\\n---\\n\\n## \ub9c8\uce58\uba70\\nRedis\uc5d0\uc11c \uc9c1\uc811 `SETNX`\ub85c \ub77d\uc744 \uad6c\ud604\ud558\uace0, \uc2a4\ud540\ub77d\uc73c\ub85c \ubc18\ubcf5 \ud655\uc778\ud558\uace0, TTL\uacfc \ud2b8\ub79c\uc7ad\uc158 \ud0c0\uc774\ubc0d\uc744 \uc218\ub3d9\uc73c\ub85c \ub9de\ucd94\ub358 \ucf54\ub4dc\uc640 \ube44\uad50\ud558\uba74\\n`Redisson`\uc740 \ubd84\uc0b0\ub77d\uc744 \ud6e8\uc52c \ub354 \uc548\uc804\ud558\uace0, \uac04\uacb0\ud558\uac8c \uad00\ub9ac\ud560 \uc218 \uc788\ub294 \ub3c4\uad6c\uc785\ub2c8\ub2e4.\\n\\n\uc9c1\uc811 \uad6c\ud604\ud558\ub824\uba74 \ubcf5\uc7a1\ud574\uc9c8 \ubaa8\ub4e0 \uae30\ub2a5\uc744 `Redisson`\uc774 \uc77c\uad00\ub41c \ubc29\uc2dd\uc73c\ub85c \uc81c\uacf5\ud569\ub2c8\ub2e4.  \\n- \uc7ac\uc9c4\uc785(Reentrant) \ub77d\\n- Pub/Sub \uae30\ubc18 \ub300\uae30\\n- \uc790\ub3d9 \uc5f0\uc7a5\uc744 \uc704\ud55c watchdog\\n- Lua \uc2a4\ud06c\ub9bd\ud2b8\ub97c \ud1b5\ud55c \uc6d0\uc790\uc801 \ub77d \uad00\ub9ac"},{"id":"spring-cloud-config-decrypt","metadata":{"permalink":"/blog/spring-cloud-config-decrypt","source":"@site/blog/2025-04-07-spring-cloud-config-decrypt.mdx","title":"Spring Cloud Config\uc758 \ubcf5\ud638\ud654 \uc2e4\ud328 \ucc98\ub9ac \uacfc\uc815 \u2014 {cipher}...\uac00 invalid.*\ub85c \ubc14\ub00c\ub294 \uc774\uc720","description":"Spring Cloud Config Server\ub97c \uc4f0\ub2e4 \ubcf4\uba74,","date":"2025-04-07T00:00:00.000Z","tags":[{"inline":false,"label":"Spring","permalink":"/blog/tags/spring","description":"Spring tag description"}],"readingTime":3.145,"hasTruncateMarker":true,"authors":[{"name":"Johny Cho","title":"Back End Engineer @ NHN","url":"https://github.com/johnycho","page":{"permalink":"/blog/authors/johnycho"},"socials":{"github":"https://github.com/johnycho","instagram":"https://www.instagram.com/johny__cho","linkedin":"https://www.linkedin.com/in/johny-cho/"},"imageURL":"https://github.com/johnycho.png","key":"johnycho"}],"frontMatter":{"slug":"spring-cloud-config-decrypt","title":"Spring Cloud Config\uc758 \ubcf5\ud638\ud654 \uc2e4\ud328 \ucc98\ub9ac \uacfc\uc815 \u2014 {cipher}...\uac00 invalid.*\ub85c \ubc14\ub00c\ub294 \uc774\uc720","authors":["johnycho"],"tags":["spring"]},"unlisted":false,"prevItem":{"title":"Redis Spin Lock\uc5d0\uc11c Redisson \uae30\ubc18 \ubd84\uc0b0\ub77d\uc73c\ub85c \uac1c\uc120\ud558\uae30","permalink":"/blog/redis-distributed-lock"},"nextItem":{"title":"\uc138\ucee8\ub354\ub9ac \uc778\ub371\uc2a4\uc640 PK \uc778\ub371\uc2a4 \uac04 \ub370\ub4dc\ub77d, \uc65c \ubc1c\uc0dd\ud560\uae4c?","permalink":"/blog/index-deadlock"}},"content":"\x3c!-- truncate --\x3e\\n<br /><br />\\n\\n# Spring Cloud Config\uc758 \ubcf5\ud638\ud654 \uc2e4\ud328 \ucc98\ub9ac \uacfc\uc815 \u2014 {cipher}...\uac00 invalid.*\ub85c \ubc14\ub00c\ub294 \uc774\uc720\\nSpring Cloud Config Server\ub97c \uc4f0\ub2e4 \ubcf4\uba74,\\n\uc554\ud638\ud654\ub41c \uc124\uc815\uac12 `{cipher}...`\uac00 \ubcf5\ud638\ud654\uc5d0 \uc2e4\ud328\ud558\uba74\uc11c `invalid.my.secret` \ud615\ud0dc\ub85c \ub178\ucd9c\ub418\uace0,\\n\uacb0\uad6d \ub85c\uceec `application.properties`\uc758 \uac12\uc774 \uc801\uc6a9\ub418\ub294 \uacbd\uc6b0\uac00 \uc788\uc2b5\ub2c8\ub2e4.\\n\\n\uc624\ub298\uc740 \uadf8 \ub0b4\ubd80 \uba54\ucee4\ub2c8\uc998\uc744 \ucf54\uc5b4 \ucf54\ub4dc \ub808\ubca8\uc5d0\uc11c\uae4c\uc9c0 \ub72f\uc5b4\ubcf4\ub824 \ud569\ub2c8\ub2e4.\\n\\n## \uc554\ud638\ud654\ub41c \uc124\uc815\uc774 \uc11c\ubc84\uc5d0 \uc804\ub2ec\ub418\ub294 \uad6c\uc870\\nConfig Server\ub294 Git, FileSystem, Vault \ub4f1\uc5d0\uc11c \uc124\uc815 \ud30c\uc77c\uc744 \uc77d\uace0,\\n`EnvironmentRepository.findOne()`\uc744 \ud1b5\ud574 \ud074\ub77c\uc774\uc5b8\ud2b8\uc5d0 `Environment` \uac1d\uccb4(JSON)\ub97c \ubc18\ud658\ud569\ub2c8\ub2e4.\\n\\n\uc774\ub54c \uc124\uc815\uac12 \uc911 `{cipher}...`\ub85c \uc2dc\uc791\ud558\ub294 \ud56d\ubaa9\uc774 \uc788\uc73c\uba74  \\n`EnvironmentController` \u2192 `EnvironmentRepository` \u2192 `EnvironmentEncryptor.decrypt()`\\n\ub2e8\uacc4\ub97c \uac70\uce58\uba70 \ubcf5\ud638\ud654\ub97c \uc2dc\ub3c4\ud569\ub2c8\ub2e4.\\n```java\\n// EnvironmentEncryptorEnvironmentRepository.java\\n@Override\\npublic Environment findOne(String name, String profiles, String label, boolean includeOrigin) {\\n    Environment environment = this.delegate.findOne(name, profiles, label, includeOrigin);\\n    if (this.environmentEncryptors != null) {\\n        for (EnvironmentEncryptor environmentEncryptor : environmentEncryptors) {\\n            environment = environmentEncryptor.decrypt(environment);\\n        }\\n    }\\n    if (!this.overrides.isEmpty()) {\\n        environment.addFirst(new PropertySource(\\"overrides\\", getOverridesMap(includeOrigin)));\\n    }\\n    return environment;\\n}\\n```\\n\uae30\ubcf8\uc801\uc73c\ub85c \uc544\ub798 \ub450 \uac1c\uc758 `EnvironmentEncryptor`\uac00 \uc874\uc7ac\ud569\ub2c8\ub2e4.\\n* `CipherEnvironmentEncryptor` (\uae30\ubcf8 RSA/Key \uae30\ubc18 \ubcf5\ud638\ud654)\\n* `VaultEnvironmentEncryptor` (HashiCorp Vault \uc5f0\ub3d9 \uc2dc)\\n\\n## \ubcf5\ud638\ud654 \uc2e4\ud328 \uc2dc `invalid.*` \ud0a4\ub85c \ubb34\ud6a8\ud654 \ucc98\ub9ac\\n`CipherEnvironmentEncryptor.decrypt()` \ub0b4\ubd80\ub97c \ubcf4\uba74,\\n\uac01 `PropertySource`\uc758 \ud0a4/\uac12\uc744 \uc21c\ud68c\ud558\uba70 `{cipher}` \uc811\ub450\uc5b4\uac00 \ubd99\uc740 \ud56d\ubaa9\uc744 \ubcf5\ud638\ud654\ud569\ub2c8\ub2e4.\\n\\n\ubcf5\ud638\ud654 \uc911 \uc608\uc678(`EncryptionOperationNotPossibleException`)\uac00 \ubc1c\uc0dd\ud558\uba74 \ub2e4\uc74c\uacfc \uac19\uc774 \ucc98\ub9ac\ub429\ub2c8\ub2e4.\\n```java\\n// CipherEnvironmentEncryptor.decrypt() \ucf54\ub4dc \uc694\uc57d\\ncatch (Exception e){\\n    if(this.prefixInvalidProperties) {\\n        value = \\"<n/a>\\";\\n        name = \\"invalid.\\" + name;\\n    }\\n    String message = \\"Cannot decrypt key: \\" + key + \\" (\\" + e.getClass() + \\": \\" + e.getMessage() + \\")\\";\\n}\\nmap.put(name, value);\\n```\\n\uc989, \uc6d0\ub798 \ud0a4 `my.secret` \ub300\uc2e0 `invalid.my.secret`\uc774 \ucd94\uac00\ub429\ub2c8\ub2e4.  \\n\uc774\ub54c \uae30\uc874 `my.secret` \ud0a4\ub294 \uc874\uc7ac\ud558\uc9c0 \uc54a\uc73c\ubbc0\ub85c, Config Client\ub294 \uc774 \uac12\uc744 \ubb34\uc2dc\ud558\uac8c \ub429\ub2c8\ub2e4.\\n\\n## \ud074\ub77c\uc774\uc5b8\ud2b8\uc5d0\uc11c `invalid.*` \uac00 \ubb34\uc2dc\ub418\ub294 \uc774\uc720\\nConfig Client\uac00 \uc11c\ubc84\ub85c\ubd80\ud130 \ubc1b\uc740 \uc124\uc815\uc744 `Environment`\ub85c \uba38\uc9c0\ud560 \ub54c,\\n`PropertySourcesPropertyResolver`\uac00 \uc21c\uc11c\ub300\ub85c `PropertySource`\ub97c \uc21c\ud68c\ud558\uba70 \uac12\uc744 \ucc3e\uc2b5\ub2c8\ub2e4.\\n1.\\t\uba3c\uc800 `configserver:*` `PropertySource`\ub97c \ud0d0\uc0c9\\n2.\\t`{cipher}` \ubcf5\ud638\ud654 \uc2e4\ud328 \u2192 `invalid.my.secret`\ub9cc \uc874\uc7ac\\n3.\\t\ucc3e\uc9c0 \ubabb\ud558\uba74 \ub2e4\uc74c `PropertySource` (\ub85c\uceec \ud30c\uc77c \ub4f1)\ub85c fall-through\\n4.\\t`application.properties`\uc5d0\uc11c `my.secret=localValue` \ubc1c\uacac \u2192 \ubc18\ud658 \u2705\\n\\n\uc989, `invalid.*` \ud0a4\ub294 <mark>**\ub2e8\uc9c0 \uc2e4\ud328 \ud754\uc801\uc77c \ubfd0**</mark>, `Environment`\uc5d0\uc11c\ub294 <mark>**\ucc38\uc870\ub418\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4.**</mark>\\n\\n\uc774 \ub3d9\uc791\uc740 `AbstractEnvironment` \ub0b4\ubd80\uc5d0\uc11c merge\ub420 \ub54c, \ub2e8\uc21c\ud788 `PropertySource` \uc21c\uc11c\ub300\ub85c \ubd99\uae30 \ub54c\ubb38\uc5d0\\n\ud2b9\ubcc4\ud55c \uc608\uc678\ucc98\ub9ac \uc5c6\uc774 <mark>\u201c\ub4a4\uc5d0 \uc624\ub294 `PropertySource`\uac00 \uc6b0\uc120\uad8c\uc744 \uac00\uc9c4\ub2e4\u201d</mark>\ub294 \uc77c\ubc18 \uaddc\uce59\uc73c\ub85c \ud574\uacb0\ub429\ub2c8\ub2e4."},{"id":"index-deadlock","metadata":{"permalink":"/blog/index-deadlock","source":"@site/blog/2025-03-03-index-deadlock.mdx","title":"\uc138\ucee8\ub354\ub9ac \uc778\ub371\uc2a4\uc640 PK \uc778\ub371\uc2a4 \uac04 \ub370\ub4dc\ub77d, \uc65c \ubc1c\uc0dd\ud560\uae4c?","description":"MySQL InnoDB\uc5d0\uc11c UPDATE, DELETE, SELECT ... FOR UPDATE \ub4f1\uc73c\ub85c \ub808\ucf54\ub4dc\ub97c \uc7a0\uae00 \ub54c","date":"2025-03-03T00:00:00.000Z","tags":[{"inline":false,"label":"MySQL","permalink":"/blog/tags/mysql","description":"MySQL tag description"}],"readingTime":4.655,"hasTruncateMarker":true,"authors":[{"name":"Johny Cho","title":"Back End Engineer @ NHN","url":"https://github.com/johnycho","page":{"permalink":"/blog/authors/johnycho"},"socials":{"github":"https://github.com/johnycho","instagram":"https://www.instagram.com/johny__cho","linkedin":"https://www.linkedin.com/in/johny-cho/"},"imageURL":"https://github.com/johnycho.png","key":"johnycho"}],"frontMatter":{"slug":"index-deadlock","title":"\uc138\ucee8\ub354\ub9ac \uc778\ub371\uc2a4\uc640 PK \uc778\ub371\uc2a4 \uac04 \ub370\ub4dc\ub77d, \uc65c \ubc1c\uc0dd\ud560\uae4c?","authors":["johnycho"],"tags":["mysql"]},"unlisted":false,"prevItem":{"title":"Spring Cloud Config\uc758 \ubcf5\ud638\ud654 \uc2e4\ud328 \ucc98\ub9ac \uacfc\uc815 \u2014 {cipher}...\uac00 invalid.*\ub85c \ubc14\ub00c\ub294 \uc774\uc720","permalink":"/blog/spring-cloud-config-decrypt"},"nextItem":{"title":"\ud83c\udf89 \uac1c\ubc1c \ube14\ub85c\uadf8 \uc624\ud508 \ud83c\udf89","permalink":"/blog/johny-dev-blog-launched"}},"content":"\x3c!-- truncate --\x3e\\n<br /><br />\\n\\n# \uc138\ucee8\ub354\ub9ac \uc778\ub371\uc2a4\uc640 PK \uc778\ub371\uc2a4 \uac04 \ub370\ub4dc\ub77d, \uc65c \ubc1c\uc0dd\ud560\uae4c?\\nMySQL `InnoDB`\uc5d0\uc11c `UPDATE`, `DELETE`, `SELECT ... FOR UPDATE` \ub4f1\uc73c\ub85c \ub808\ucf54\ub4dc\ub97c \uc7a0\uae00 \ub54c  \\n<mark>PK \uc778\ub371\uc2a4 \ubfd0 \uc544\ub2c8\ub77c \uc138\ucee8\ub354\ub9ac \uc778\ub371\uc2a4\uae4c\uc9c0 \ub77d\uc774 \uac78\ub9ac\uba74\uc11c \uad50\ucc29 \uc0c1\ud0dc(Deadlock)\uac00 \ubc1c\uc0dd</mark>\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.\\n\\n`InnoDB`\ub294 \ubcf4\uc870 \uc778\ub371\uc2a4\ub97c \ud1b5\ud574 \uc811\uadfc\ud558\ub354\ub77c\ub3c4 \uc2e4\uc81c \ub77d\uc740 PK \uae30\ubc18\uc73c\ub85c \uac78\uae30 \ub54c\ubb38\uc5d0,  \\n\uc138\ucee8\ub354\ub9ac \uc778\ub371\uc2a4\uc640 PK \uc778\ub371\uc2a4\uac00 \uc11c\ub85c \ub2e4\ub978 \ud2b8\ub79c\uc7ad\uc158\uc5d0\uc11c \uc5c7\uac08\ub824 \ub77d\uc744 \uac78\uba74 \ub370\ub4dc\ub77d\uc774 \uc0dd\uae41\ub2c8\ub2e4.\\n\\n## MySQL\uc758 \ub77d \ub3d9\uc791 \uba54\ucee4\ub2c8\uc998\\n`InnoDB`\ub294 `Row-Level Lock`\ucc98\ub7fc \ubcf4\uc5ec\ub3c4 \ub0b4\ubd80\uc801\uc73c\ub85c\ub294 <mark>**\uc778\ub371\uc2a4 \ub808\ucf54\ub4dc \uae30\ubc18\uc758 \uc7a0\uae08**</mark> (`Record Lock`)\\n\\n## \uc608\uc81c \uc2dc\ub098\ub9ac\uc624\\n```sql\\nCREATE TABLE user_balance (\\n  id BIGINT PRIMARY KEY,\\n  user_id BIGINT,\\n  balance INT,\\n  KEY idx_user (user_id)\\n) ENGINE=InnoDB;\\n```\\n\\n### \ud2b8\ub79c\uc7ad\uc158 A\\n```sql\\nBEGIN;\\nSELECT * FROM user_balance WHERE user_id = 100 FOR UPDATE;\\n-- \u2192 \uc138\ucee8\ub354\ub9ac \uc778\ub371\uc2a4(idx_user)\ub85c \ud0d0\uc0c9 \ud6c4, PK lookup \uc218\ud589\\n-- \u2192 (\uc138\ucee8\ub354\ub9ac \ub77d \u2192 PK \ub77d) \uc21c\uc11c\ub85c \ub77d \ud68d\ub4dd\\n```\\n\\n### \ud2b8\ub79c\uc7ad\uc158 B\\n```sql\\nBEGIN;\\nUPDATE user_balance SET balance = balance + 10 WHERE id = 10;\\n-- \u2192 PK \uc778\ub371\uc2a4\ub85c \uc9c1\uc811 \uc811\uadfc\\n-- \u2192 (PK \ub77d) \uba3c\uc800 \ud68d\ub4dd\\n```\\n\\n\uc774 \uc0c1\ud0dc\uc5d0\uc11c A\uc640 B\uac00 \ub3d9\uc77c\ud55c row\ub97c \uac00\ub9ac\ud0a4\ub294 PK\ub97c \uac01\uc790 \ub2e4\ub978 \uc778\ub371\uc2a4 \uacbd\ub85c\ub85c \uc811\uadfc\ud558\uba74,\\n\uc11c\ub85c\uac00 \uc0c1\ub300\uc758 \ub77d\uc744 \uae30\ub2e4\ub9ac\uba70 \ub370\ub4dc\ub77d\uc774 \ubc1c\uc0dd\ud569\ub2c8\ub2e4.\\n\\n### \ub0b4\ubd80 \ub77d \ud50c\ub85c\uc6b0 \ubd84\uc11d\\n<table>\\n  <tr><th>\uc21c\uc11c</th><th>A (\uc138\ucee8\ub354\ub9ac \uc778\ub371\uc2a4 \uacbd\ub85c)</th><th>B (PK \uacbd\ub85c)</th></tr>\\n  <tr><td style={{ textAlign: \'center\' }}>1</td><td>`idx_user` \uc778\ub371\uc2a4 \ud0d0\uc0c9 (Record Lock)</td><td>PK = 10 Row Lock</td></tr>\\n  <tr><td style={{ textAlign: \'center\' }}>2</td><td>PK lookup\uc73c\ub85c \uc804\ud658\ud558\ub824 \ud568</td><td>\uc774\ubbf8 B\uac00 PK \ub77d\uc744 \uc120\uc810</td></tr>\\n  <tr><td style={{ textAlign: \'center\' }}>3</td><td>\ub300\uae30 \uc0c1\ud0dc \uc9c4\uc785</td><td>A\uac00 `idx_user` \ub77d\uc744 \uc120\uc810 \uc911</td></tr>\\n  <tr><td style={{ textAlign: \'center\' }}>4</td><td colSpan={2} style={{ textAlign: \'center\' }}>\uc11c\ub85c \uc0c1\ub300 \ub77d\uc744 \uae30\ub2e4\ub9ac\uba70 Deadlock</td></tr>\\n</table>\\n\uc989, <mark>\ub77d \ud68d\ub4dd \uc21c\uc11c \ubd88\uc77c\uce58 (Lock Ordering Inconsistency) \uac00 \ub370\ub4dc\ub77d\uc758 \ud575\uc2ec \uc6d0\uc778</mark>\uc785\ub2c8\ub2e4.\\n\\n<table>\\n  <thead>\\n    <tr>\\n      <th style={{ whiteSpace: \'nowrap\', textAlign: \'center\' }}>\uc21c\uc11c</th>\\n      <th>\ud2b8\ub79c\uc7ad\uc158 A</th>\\n      <th>\ud2b8\ub79c\uc7ad\uc158 B</th>\\n    </tr>\\n  </thead>\\n  <tbody>\\n    <tr>\\n      <td style={{ textAlign: \'center\' }}>1</td>\\n      <td><code>idx_user</code> \ub77d \ud68d\ub4dd</td>\\n      <td></td>\\n    </tr>\\n    <tr>\\n      <td style={{ textAlign: \'center\' }}>2</td>\\n      <td>PK\ub85c lookup \uc2dc\ub3c4, \ud558\uc9c0\ub9cc B\uac00 \uc774\ubbf8 PK \ub77d \ubcf4\uc720</td>\\n      <td></td>\\n    </tr>\\n    <tr>\\n      <td style={{ textAlign: \'center\' }}>3</td>\\n      <td>\ub300\uae30 \uc0c1\ud0dc</td>\\n      <td>PK \ub77d \ubcf4\uc720 \uc911</td>\\n    </tr>\\n    <tr>\\n      <td style={{ textAlign: \'center\' }}>4</td>\\n      <td></td>\\n      <td>B\ub294 \uc5c5\ub370\uc774\ud2b8 \uc911, PK \ub77d\uc744 \uac00\uc9c4 \uc0c1\ud0dc\ub85c \ub0b4\ubd80\uc801\uc73c\ub85c \uc778\ub371\uc2a4 \uc815\ud569\uc131 \uc720\uc9c0 \uc704\ud574 <code>idx_user</code> \uac31\uc2e0 \ud544\uc694</td>\\n    </tr>\\n    <tr>\\n      <td style={{ textAlign: \'center\' }}>5</td>\\n      <td></td>\\n      <td>\uadf8\ub7f0\ub370 <code>idx_user</code>\ub294 A\uac00 \ub77d\uc744 \uc7a1\uace0 \uc788\uc74c</td>\\n    </tr>\\n    <tr>\\n      <td style={{ textAlign: \'center\' }}>6</td>\\n      <td>\ud83d\udea8 \uad50\ucc29 \ubc1c\uc0dd</td>\\n      <td>\ud83d\udea8 \uad50\ucc29 \ubc1c\uc0dd</td>\\n    </tr>\\n  </tbody>\\n</table>\\n\\n## \ud2b8\ub79c\uc7ad\uc158 B\ub294 PK\ub85c\ub9cc \uc811\uadfc\ud588\ub294\ub370 \uc65c \uc138\ucee8\ub354\ub9ac \uc778\ub371\uc2a4(`idx_user`) \ub77d\uc744 \uae30\ub2e4\ub9b4\uae4c?\\n`InnoDB`\ub294 UPDATE \uc2dc <mark>PK\ubfd0\ub9cc \uc544\ub2c8\ub77c \ubaa8\ub4e0 \uad00\ub828 \uc778\ub371\uc2a4\uc758 \uc5d4\ud2b8\ub9ac\ub3c4 \uc218\uc815\ud574\uc57c \ud558\uae30 \ub54c\ubb38</mark>\uc785\ub2c8\ub2e4.\\n> UPDATE user_balance SET balance = ...   \\n> \u2192 PK \ud14c\uc774\ube14 \ud398\uc774\uc9c0 \uc218\uc815\ubfd0\ub9cc \uc544\ub2c8\ub77c  \\n> \u2192 \uc138\ucee8\ub354\ub9ac \uc778\ub371\uc2a4(idx_user)\uc758 \ud574\ub2f9 \uc5d4\ud2b8\ub9ac\ub3c4 \ubcc0\uacbd\ub418\uc5b4\uc57c \ud568 (user_id\uac00 \ubcc0\ud558\uc9c0 \uc54a\ub354\ub77c\ub3c4 consistency \uc720\uc9c0 \uc704\ud574 latch \ud68d\ub4dd \ud544\uc694)\\n\\n\uc774\ub54c, \uc774\ubbf8 \ud2b8\ub79c\uc7ad\uc158 A\uac00 idx_user\uc5d0\uc11c \uc7a0\uae08\uc744 \uac00\uc9c0\uace0 \uc788\uc73c\ubbc0\ub85c,  \\nB\ub294 \uadf8 \uc138\ucee8\ub354\ub9ac \uc778\ub371\uc2a4 \uc5d4\ud2b8\ub9ac\uc5d0 \ub300\ud55c latch/lock\uc744 \uae30\ub2e4\ub9ac\uac8c \ub429\ub2c8\ub2e4.\\n\\nB\ub294 `user_id` \uc778\ub371\uc2a4\ub97c \uc9c1\uc811 \uc870\ud68c\ud558\uc9c0 \uc54a\uc558\ub354\ub77c\ub3c4,  \\nUPDATE \ubb38\uc774 \ub0b4\ubd80\uc801\uc73c\ub85c `idx_user` \uc778\ub371\uc2a4 \ud398\uc774\uc9c0\ub97c \uac31\uc2e0\ud574\uc57c \ud558\uae30 \ub54c\ubb38\uc5d0  \\nA\uac00 \uc7a1\uc740 `idx_user` \ub77d\uc5d0 \ub9c9\ud600 \ub300\uae30\ud558\ub2e4\uac00 \uad50\ucc29(deadlock)\uc774 \ubc1c\uc0dd\ud558\ub294 \uac83\uc785\ub2c8\ub2e4.\\n\\n## \ub370\ub4dc\ub77d \ub85c\uadf8 \ud655\uc778 \ubc29\ubc95\\n```sql\\nSHOW ENGINE INNODB STATUS\\\\G\\n```"},{"id":"johny-dev-blog-launched","metadata":{"permalink":"/blog/johny-dev-blog-launched","source":"@site/blog/2025-02-03-johny-dev-blog-launched.mdx","title":"\ud83c\udf89 \uac1c\ubc1c \ube14\ub85c\uadf8 \uc624\ud508 \ud83c\udf89","description":"_","date":"2025-02-03T00:00:00.000Z","tags":[{"inline":false,"label":"Hello","permalink":"/blog/tags/hello","description":"Hello tag description"}],"readingTime":2.835,"hasTruncateMarker":true,"authors":[{"name":"Johny Cho","title":"Back End Engineer @ NHN","url":"https://github.com/johnycho","page":{"permalink":"/blog/authors/johnycho"},"socials":{"github":"https://github.com/johnycho","instagram":"https://www.instagram.com/johny__cho","linkedin":"https://www.linkedin.com/in/johny-cho/"},"imageURL":"https://github.com/johnycho.png","key":"johnycho"}],"frontMatter":{"slug":"johny-dev-blog-launched","title":"\ud83c\udf89 \uac1c\ubc1c \ube14\ub85c\uadf8 \uc624\ud508 \ud83c\udf89","authors":["johnycho"],"tags":["hello"]},"unlisted":false,"prevItem":{"title":"\uc138\ucee8\ub354\ub9ac \uc778\ub371\uc2a4\uc640 PK \uc778\ub371\uc2a4 \uac04 \ub370\ub4dc\ub77d, \uc65c \ubc1c\uc0dd\ud560\uae4c?","permalink":"/blog/index-deadlock"}},"content":"import BrowserOnly from \'@docusaurus/BrowserOnly\';\\n\\n___\\n\\n\x3c!-- truncate --\x3e\\n<br /><br />\\n\\n# \ud14c\uc2a4\ud2b8 \ub9c8\ud06c \ub2e4\uc6b4 \ubb38\uc11c\ub97c \uc791\uc131\ud574\ubd05\ub2c8\ub2e4..\\n\\n## :heavy_check_mark:\ufe0f Glorious Demo with TypeScript\\n---\\n\uc544\ub798\ub294 `glorious-demo`\ub97c \uc774\uc6a9\ud55c \uc5d0\ub514\ud130 + \ud130\ubbf8\ub110 \uc560\ub2c8\uba54\uc774\uc158 \uc608\uc81c\uc785\ub2c8\ub2e4.\\n\\n<BrowserOnly fallback={<p>Loading terminal...</p>}>\\n{() => {\\nconst GloriousTerminal = require(\'@site/src/components/GloriousTerminal\').default;\\nreturn (\\n<GloriousTerminal\\ncode={`\\nfunction greet(){\\nconsole.log(\\"Hello World!\\");\\n}\\n\\ngreet();\\n`}\\ncommand=\\"node ./demo\\"\\nresponse=\\"Hello World!\\"\\n/>\\n);\\n}}\\n</BrowserOnly>\\n\\n<br /><br /><br /><br /><br /><br />\\n\\n## :heavy_check_mark: Javascript \ucf54\ub4dc \ube14\ub7ed\\n---\\n\\n```js\\n<button onClick={() => alert(\'button clicked!\')}>Click me!</button>\\n```\\n\\n## :heavy_check_mark: Java \ucf54\ub4dc \ube14\ub7ed\\n---\\n\\n```java\\npackage com.nhn.meta.banword.application;\\n\\nimport java.util.Arrays;\\nimport java.util.Collections;\\nimport java.util.Map;\\nimport java.util.stream.Collectors;\\n\\npublic class Solution {\\n\\n  public static void main(String[] args) {\\n// \ud14c\uc2a4\ud2b8 \ucf00\uc774\uc2a4 \uc2e4\ud589 \ubc0f \uacb0\uacfc \ucd9c\ub825\\n    System.out.println(\\"Test Case 1 Result: \\" + solution(2, \\"1A 2F 1C\\") + \\" (Expected: 2)\\");\\n    System.out.println(\\"Test Case 2 Result: \\" + solution(3, \\"\\") + \\" (Expected: 6)\\");\\n    System.out.println(\\n        \\"Test Case 3 Result: \\" + solution(1, \\"1A 1B 1C 1D 1E 1F 1G 1H 1J 1K\\") + \\" (Expected: 0)\\");\\n    System.out.println(\\n        \\"Test Case 4 Result: \\" + solution(50, \\"1A 3C 2B 20G 5A 7K 40D 50H\\") + \\" (Expected: 95)\\");\\n    System.out.println(\\n        \\"Test Case 5 Result: \\" + solution(2, \\"1A 1C 1D 1F 1G 1J 2C 2H\\") + \\" (Expected: 1)\\");\\n    System.out.println(\\n        \\"Test Case 6 Result: \\" + solution(22, \\"1A 3C 2B 20G 5A\\") + \\" (Expected: 41)\\");\\n  }\\n\\n  public static int solution(int N, String S) {\\n    final Map<String, Boolean> reserved = splitStringToMap(S);\\n\\n    int maxFamilies = 0;\\n\\n    for (int row = 1; row <= N; row++) {\\n      boolean leftAndCenter =\\n          !reserved.containsKey(row + \\"B\\") &&\\n              !reserved.containsKey(row + \\"C\\") &&\\n              !reserved.containsKey(row + \\"D\\") &&\\n              !reserved.containsKey(row + \\"E\\");\\n\\n      boolean centerOnly =\\n          !reserved.containsKey(row + \\"D\\") &&\\n              !reserved.containsKey(row + \\"E\\") &&\\n              !reserved.containsKey(row + \\"F\\") &&\\n              !reserved.containsKey(row + \\"G\\");\\n\\n      boolean centerAndRight =\\n          !reserved.containsKey(row + \\"F\\") &&\\n              !reserved.containsKey(row + \\"G\\") &&\\n              !reserved.containsKey(row + \\"H\\") &&\\n              !reserved.containsKey(row + \\"J\\");\\n\\n      int familiesAdded = 0; // \ub514\ubc84\uae45\uc6a9 \ucd94\uac00\\n      if (leftAndCenter) {\\n        maxFamilies++;\\n        familiesAdded++;\\n      }\\n\\n      if (centerAndRight) {\\n        maxFamilies++;\\n        familiesAdded++;\\n      }\\n\\n      if (!leftAndCenter && !centerAndRight && centerOnly) {\\n        maxFamilies++;\\n        familiesAdded++;\\n      }\\n\\n      // \ud589\ubcc4\ub85c \ucd94\uac00\ub41c \uac00\uc871 \uc218 \ucd9c\ub825\\n      System.out.printf(\\n          \\"Row %d: leftAndCenter=%b, centerOnly=%b, centerAndRight=%b, Families added=%d\\\\n\\",\\n          row, leftAndCenter, centerOnly, centerAndRight, familiesAdded);\\n    }\\n\\n    return maxFamilies;\\n  }\\n\\n  public static Map<String, Boolean> splitStringToMap(String s) {\\n    if (s == null || s.trim().isEmpty()) {\\n      return Collections.emptyMap(); // \ubb38\uc790\uc5f4\uc774 \ube44\uc5b4\uc788\uc73c\uba74 \ube48 \ub9f5 \ubc18\ud658\\n    }\\n\\n    // \uacf5\ubc31 \uae30\uc900\uc73c\ub85c \ub098\ub208 \ud6c4, \uac01 \ub2e8\uc5b4\ub97c \ud0a4\ub85c, \ub2e8\uc5b4\uc758 \uae38\uc774\ub97c \uac12\uc73c\ub85c \ub9f5\uc5d0 \uc800\uc7a5\\n    return Arrays.stream(s.split(\\"\\\\\\\\s+\\")) // \uacf5\ubc31 \uae30\uc900\uc73c\ub85c \ubb38\uc790\uc5f4 \ubd84\ub9ac\\n        .filter(word -> !word.isEmpty()) // \ube44\uc5b4 \uc788\ub294 \ubb38\uc790\uc5f4 \uc81c\uac70\\n        .collect(Collectors.toMap(word -> word, word -> true));\\n  }\\n}\\n```\\n\\n## :heavy_check_mark: Task List\\n---\\n\\n- [x] Write the press release\\n- [ ] Update the website\\n- [ ] Contact the media\\n\\n## :heavy_check_mark: Using Emoji Shortcodes\\n---\\nGone camping! :tent: Be back soon.\\n\\nThat is so funny! :joy:\\n\\n## :heavy_check_mark: Highlight\\n---\\nI need to highlight these <mark>very important words</mark>.\\n\\n## :heavy_check_mark: Table\\n---\\n\\n| Syntax    | Description |\\n|-----------|-------------|\\n| Header    | Title       |\\n| Paragraph | Text        |"}]}}')}}]);